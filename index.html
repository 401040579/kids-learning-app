<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#FF69B4">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.svg">
  <title>宝贝学习乐园</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- 星星/彩带飘落效果容器 -->
  <div id="particles"></div>

  <!-- 奖励弹窗 -->
  <div id="reward-popup" class="reward-popup hidden">
    <div class="reward-content">
      <div class="reward-stars">⭐⭐⭐</div>
      <h2 class="reward-title">太棒了!</h2>
      <p class="reward-message">你获得了 <span id="reward-points">10</span> 分!</p>
      <div class="reward-animation"></div>
      <button class="btn-continue" onclick="closeReward()">继续学习</button>
    </div>
  </div>

  <!-- 拼图完成弹窗 -->
  <div id="puzzle-complete-modal" class="puzzle-complete-modal hidden">
    <div class="puzzle-complete-content">
      <div class="complete-celebration">🎉</div>
      <h2 class="puzzle-complete-title">拼图完成!</h2>
      <div class="puzzle-complete-image" id="puzzle-complete-image">🦁</div>
      <div class="puzzle-complete-stats">
        <div class="complete-stat-item">
          <span class="stat-icon">⏱</span>
          <span class="stat-value" id="puzzle-complete-time">01:23</span>
          <span class="stat-label">用时</span>
        </div>
        <div class="complete-stat-item">
          <span class="stat-icon">⭐</span>
          <span class="stat-value" id="puzzle-complete-points">+20</span>
          <span class="stat-label">积分</span>
        </div>
      </div>
      <div class="puzzle-complete-buttons">
        <button class="btn-puzzle-again" onclick="restartPuzzle()">再玩一次</button>
        <button class="btn-puzzle-new" onclick="backToPuzzleSelect()">换一张</button>
      </div>
    </div>
  </div>

  <!-- 拼图提示弹窗 -->
  <div id="puzzle-hint-modal" class="puzzle-hint-modal hidden">
    <div class="puzzle-hint-content">
      <button class="puzzle-hint-close" onclick="closePuzzleHint()">✕</button>
      <h3>原图参考</h3>
      <div class="puzzle-hint-image" id="puzzle-hint-image">🦁</div>
      <p class="puzzle-hint-name" id="puzzle-hint-name">狮子</p>
    </div>
  </div>

  <!-- 视频播放器弹窗 -->
  <div id="video-modal" class="video-modal hidden">
    <div class="video-container">
      <button class="video-close" onclick="closeVideo()">✕</button>
      <div id="video-player"></div>
      <div id="video-overlay" class="video-overlay hidden">
        <div class="overlay-content">
          <span class="overlay-emoji">🌟</span>
          <p>视频看完啦!</p>
          <button class="btn-primary" onclick="closeVideo()">返回</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 添加事件弹窗 -->
  <div id="add-event-modal" class="event-modal hidden">
    <div class="event-modal-content">
      <button class="event-modal-close" onclick="closeAddEventModal()">✕</button>
      <h3 class="event-modal-title">添加新事件</h3>

      <!-- 事件类型选择 -->
      <div class="event-type-selector">
        <button class="event-type-btn active" data-type="class" onclick="selectEventType('class')">
          <span class="type-icon">📚</span>
          <span class="type-name">课外班</span>
        </button>
        <button class="event-type-btn" data-type="outing" onclick="selectEventType('outing')">
          <span class="type-icon">🎡</span>
          <span class="type-name">出去玩</span>
        </button>
        <button class="event-type-btn" data-type="holiday" onclick="selectEventType('holiday')">
          <span class="type-icon">🏖️</span>
          <span class="type-name">放假</span>
        </button>
        <button class="event-type-btn" data-type="study" onclick="selectEventType('study')">
          <span class="type-icon">📖</span>
          <span class="type-name">学习</span>
        </button>
      </div>

      <!-- 事件表单 -->
      <form id="event-form" class="event-form">
        <div class="form-group">
          <label>事件名称</label>
          <input type="text" id="event-name" placeholder="例如：钢琴课、去动物园" required>
        </div>

        <!-- 课外班专属：课程类型 -->
        <div class="form-group class-only">
          <label>课程类型</label>
          <div class="class-type-selector" id="class-type-selector">
            <button type="button" class="class-type-btn active" data-class="piano" onclick="selectClassType('piano')">🎹 钢琴</button>
            <button type="button" class="class-type-btn" data-class="art" onclick="selectClassType('art')">🎨 画画</button>
            <button type="button" class="class-type-btn" data-class="swim" onclick="selectClassType('swim')">🏊 游泳</button>
            <button type="button" class="class-type-btn" data-class="dance" onclick="selectClassType('dance')">💃 舞蹈</button>
            <button type="button" class="class-type-btn" data-class="english" onclick="selectClassType('english')">🔤 英语</button>
            <button type="button" class="class-type-btn" data-class="math" onclick="selectClassType('math')">🔢 数学</button>
            <button type="button" class="class-type-btn" data-class="sports" onclick="selectClassType('sports')">⚽ 运动</button>
            <button type="button" class="class-type-btn" data-class="other" onclick="selectClassType('other')">📝 其他</button>
          </div>
        </div>

        <!-- 时间设置（课外班和学习专属） -->
        <div class="form-group time-group class-only">
          <label>上课时间</label>
          <div class="time-inputs">
            <input type="time" id="event-start-time" value="09:00">
            <span>到</span>
            <input type="time" id="event-end-time" value="10:00">
          </div>
        </div>

        <!-- 重复设置 -->
        <div class="form-group class-only">
          <label>重复</label>
          <div class="repeat-selector">
            <button type="button" class="repeat-btn active" data-repeat="none" onclick="selectRepeat('none')">不重复</button>
            <button type="button" class="repeat-btn" data-repeat="weekly" onclick="selectRepeat('weekly')">每周重复</button>
          </div>
        </div>

        <!-- 备注 -->
        <div class="form-group">
          <label>备注 (选填)</label>
          <textarea id="event-note" placeholder="可以写一些备注..."></textarea>
        </div>

        <button type="submit" class="btn-submit-event">保存事件</button>
      </form>
    </div>
  </div>

  <!-- 事件详情/评价弹窗 -->
  <div id="event-detail-modal" class="event-modal hidden">
    <div class="event-modal-content">
      <button class="event-modal-close" onclick="closeEventDetailModal()">✕</button>

      <div class="event-detail-header">
        <span class="event-detail-icon" id="event-detail-icon">📚</span>
        <div class="event-detail-info">
          <h3 id="event-detail-name">钢琴课</h3>
          <p id="event-detail-time">09:00 - 10:00</p>
        </div>
      </div>

      <div class="event-detail-date" id="event-detail-date">2026年1月20日</div>

      <!-- 备注显示 -->
      <div class="event-detail-note" id="event-detail-note-section">
        <h4>📝 备注</h4>
        <p id="event-detail-note">无</p>
      </div>

      <!-- 心情评价（仅已完成的课外班显示） -->
      <div class="event-mood-section" id="event-mood-section">
        <h4>这次课感觉怎么样?</h4>
        <div class="mood-selector">
          <button class="mood-btn" data-mood="happy" onclick="selectMood('happy')">
            <span class="mood-emoji">😊</span>
            <span class="mood-text">开心</span>
          </button>
          <button class="mood-btn" data-mood="neutral" onclick="selectMood('neutral')">
            <span class="mood-emoji">😐</span>
            <span class="mood-text">一般</span>
          </button>
          <button class="mood-btn" data-mood="sad" onclick="selectMood('sad')">
            <span class="mood-emoji">😢</span>
            <span class="mood-text">不开心</span>
          </button>
          <button class="mood-btn" data-mood="tired" onclick="selectMood('tired')">
            <span class="mood-emoji">😫</span>
            <span class="mood-text">好累</span>
          </button>
          <button class="mood-btn" data-mood="excited" onclick="selectMood('excited')">
            <span class="mood-emoji">🤩</span>
            <span class="mood-text">超棒</span>
          </button>
        </div>

        <!-- 感受记录 -->
        <div class="feeling-input">
          <label>写写你的感受吧:</label>
          <textarea id="event-feeling" placeholder="今天学了什么? 有趣吗?"></textarea>
        </div>

        <button class="btn-save-mood" onclick="saveMoodAndFeeling()">保存心情</button>
      </div>

      <!-- 已保存的心情显示 -->
      <div class="saved-mood-display hidden" id="saved-mood-display">
        <h4>我的心情记录</h4>
        <div class="saved-mood-content">
          <span class="saved-mood-emoji" id="saved-mood-emoji">😊</span>
          <p class="saved-mood-feeling" id="saved-mood-feeling">很开心!</p>
        </div>
      </div>

      <!-- 操作按钮 -->
      <div class="event-actions">
        <button class="btn-delete-event" onclick="deleteEvent()">🗑️ 删除</button>
      </div>
    </div>
  </div>

  <!-- 主应用 -->
  <div id="app">
    <!-- 顶部状态栏 -->
    <header class="header">
      <div class="header-left">
        <span class="app-title">🌈 学习乐园</span>
      </div>
      <div class="header-right">
        <div class="score-display">
          <span class="star-icon">⭐</span>
          <span id="total-score">0</span>
        </div>
      </div>
    </header>

    <!-- 页面内容区 -->
    <main id="main-content">
      <!-- 首页 -->
      <section id="page-home" class="page active">
        <div class="welcome-section">
          <h1 class="welcome-title">
            <span class="wave">👋</span> 欢迎小朋友!
          </h1>
          <p class="welcome-subtitle">今天想学什么呢?</p>
        </div>

        <!-- 首页分类标签 -->
        <div class="home-category-tabs">
          <button class="home-tab active" data-category="all" onclick="filterHomeCards('all')">
            <span class="tab-emoji">🌟</span>
            <span>全部</span>
          </button>
          <button class="home-tab" data-category="learn" onclick="filterHomeCards('learn')">
            <span class="tab-emoji">📚</span>
            <span>学习</span>
          </button>
          <button class="home-tab" data-category="play" onclick="filterHomeCards('play')">
            <span class="tab-emoji">🎮</span>
            <span>游戏</span>
          </button>
          <button class="home-tab" data-category="tools" onclick="filterHomeCards('tools')">
            <span class="tab-emoji">🔧</span>
            <span>工具</span>
          </button>
        </div>

        <div class="menu-grid" id="home-menu-grid">
          <!-- 学习类 -->
          <div class="menu-card card-math" data-category="learn" onclick="navigateTo('math')">
            <div class="card-icon">🔢</div>
            <div class="card-title">数学游戏</div>
            <div class="card-desc">加减法挑战</div>
          </div>

          <div class="menu-card card-english" data-category="learn" onclick="navigateTo('english')">
            <div class="card-icon">🔤</div>
            <div class="card-title">学英语</div>
            <div class="card-desc">字母和单词</div>
          </div>

          <div class="menu-card card-chinese" data-category="learn" onclick="navigateTo('chinese')">
            <div class="card-icon">📝</div>
            <div class="card-title">学中文</div>
            <div class="card-desc">认字和拼音</div>
          </div>

          <div class="menu-card card-science" data-category="learn" onclick="navigateTo('science')">
            <div class="card-icon">🔬</div>
            <div class="card-title">科学探索</div>
            <div class="card-desc">发现神奇世界</div>
          </div>

          <!-- 游戏类 -->
          <div class="menu-card card-explore" data-category="play" onclick="navigateTo('explore')">
            <div class="card-icon">🎬</div>
            <div class="card-title">探索视频</div>
            <div class="card-desc">看有趣的视频</div>
          </div>

          <div class="menu-card card-puzzle" data-category="play" onclick="navigateTo('puzzle')">
            <div class="card-icon">🧩</div>
            <div class="card-title">拼图游戏</div>
            <div class="card-desc">锻炼观察力</div>
          </div>

          <!-- 工具类 -->
          <div class="menu-card card-timer" data-category="tools" onclick="navigateTo('timer')">
            <div class="card-icon">⏰</div>
            <div class="card-title">玩耍计时</div>
            <div class="card-desc">设置倒计时</div>
          </div>

          <div class="menu-card card-calendar" data-category="tools" onclick="navigateTo('calendar')">
            <div class="card-icon">📅</div>
            <div class="card-title">我的日历</div>
            <div class="card-desc">记录每一天</div>
          </div>

          <div class="menu-card card-sleep-music" data-category="tools" onclick="navigateTo('sleep-music')">
            <div class="card-icon">🎵</div>
            <div class="card-title">睡眠音乐</div>
            <div class="card-desc">助眠好音乐</div>
          </div>

          <div class="menu-card card-profile" data-category="tools" onclick="navigateTo('profile')">
            <div class="card-icon">👤</div>
            <div class="card-title">我的信息</div>
            <div class="card-desc">编辑个人资料</div>
          </div>

          <!-- P0新功能入口 -->
          <div class="menu-card card-checkin" data-category="tools" onclick="showCheckin()">
            <div class="card-icon">📅</div>
            <div class="card-title">每日签到</div>
            <div class="card-desc">签到领奖励</div>
            <div id="checkin-preview" class="checkin-preview-mini"></div>
          </div>

          <div class="menu-card card-achievements" data-category="tools" onclick="showAchievements()">
            <div class="card-icon">🏆</div>
            <div class="card-title">我的成就</div>
            <div class="card-desc">徽章收集</div>
          </div>

          <div class="menu-card card-wrong-questions" data-category="tools" onclick="showWrongQuestions()">
            <div class="card-icon">📕</div>
            <div class="card-title">错题本</div>
            <div class="card-desc">复习巩固</div>
          </div>

          <!-- P1新功能入口 -->
          <div class="menu-card card-memory-game" data-category="play" onclick="showMemoryGame()">
            <div class="card-icon">🧠</div>
            <div class="card-title">记忆训练</div>
            <div class="card-desc">锻炼记忆力</div>
          </div>

          <div class="menu-card card-learning-pet" data-category="play" onclick="showLearningPet()">
            <div class="card-icon">🐱</div>
            <div class="card-title">学习宠物</div>
            <div class="card-desc">陪你一起学</div>
          </div>

          <div class="menu-card card-learning-report" data-category="tools" onclick="showLearningReport()">
            <div class="card-icon">📊</div>
            <div class="card-title">学习报告</div>
            <div class="card-desc">查看进步</div>
          </div>

          <!-- P2新功能入口 -->
          <div class="menu-card card-picture-book" data-category="learn" onclick="showPictureBook()">
            <div class="card-icon">📚</div>
            <div class="card-title">绘本故事</div>
            <div class="card-desc">听故事学知识</div>
          </div>

          <div class="menu-card card-pronunciation" data-category="learn" onclick="showPronunciation()">
            <div class="card-icon">🎤</div>
            <div class="card-title">跟读练习</div>
            <div class="card-desc">练习发音</div>
          </div>

        </div>

        <div class="daily-progress">
          <h3>今日进度</h3>
          <div class="progress-bar">
            <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
          </div>
          <p class="progress-text">完成 <span id="tasks-done">0</span>/10 个任务解锁奖励视频!</p>
        </div>
      </section>

      <!-- 探索视频页 -->
      <section id="page-explore" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')">← 返回</button>
          <h2>🎬 探索视频</h2>
        </div>

        <!-- 分类标签 -->
        <div class="category-tabs" id="category-tabs">
          <button class="category-tab active" data-category="all" onclick="filterVideos('all')">
            <span class="tab-icon">📚</span>
            <span class="tab-name">全部</span>
          </button>
          <button class="category-tab" data-category="math" onclick="filterVideos('math')">
            <span class="tab-icon">🔢</span>
            <span class="tab-name">数学</span>
          </button>
          <button class="category-tab" data-category="english" onclick="filterVideos('english')">
            <span class="tab-icon">🔤</span>
            <span class="tab-name">英语</span>
          </button>
          <button class="category-tab" data-category="science" onclick="filterVideos('science')">
            <span class="tab-icon">🔬</span>
            <span class="tab-name">科普</span>
          </button>
          <button class="category-tab" data-category="emotion" onclick="filterVideos('emotion')">
            <span class="tab-icon">💝</span>
            <span class="tab-name">情绪</span>
          </button>
          <button class="category-tab" data-category="brain" onclick="filterVideos('brain')">
            <span class="tab-icon">🧠</span>
            <span class="tab-name">脑力</span>
          </button>
          <button class="category-tab" data-category="music" onclick="filterVideos('music')">
            <span class="tab-icon">🎵</span>
            <span class="tab-name">音乐</span>
          </button>
        </div>

        <!-- 当前分类描述 -->
        <div class="category-info" id="category-info">
          <p class="category-desc">精选30个适合6岁儿童的优质视频</p>
        </div>

        <!-- 视频网格 -->
        <div class="video-grid" id="video-grid">
          <!-- 默认加载状态 -->
          <div class="video-loading">
            <span class="loading-icon">🎬</span>
            <p>加载中...</p>
          </div>
        </div>
      </section>

      <!-- 视频详情弹窗 -->
      <div id="video-detail-modal" class="video-detail-modal hidden">
        <div class="video-detail-content">
          <button class="video-detail-close" onclick="closeVideoDetail()">✕</button>
          <div class="video-detail-header">
            <span class="video-detail-icon" id="detail-icon">🎬</span>
            <div class="video-detail-title-area">
              <h3 id="detail-title">视频标题</h3>
              <p id="detail-title-zh" class="detail-title-zh">中文标题</p>
            </div>
          </div>
          <div class="video-detail-meta">
            <span class="meta-tag" id="detail-duration">⏱️ 5:00</span>
            <span class="meta-tag" id="detail-channel">📺 频道</span>
            <span class="meta-tag" id="detail-age">👶 5-7岁</span>
          </div>
          <div class="video-detail-section">
            <h4>📖 简介</h4>
            <p id="detail-desc">视频描述</p>
          </div>
          <div class="video-detail-section">
            <h4>✅ 为什么推荐</h4>
            <p id="detail-why">推荐理由</p>
          </div>
          <div class="video-detail-section">
            <h4>🎯 技能培养</h4>
            <div class="skill-tags" id="detail-skills">
              <!-- 技能标签由 JS 生成 -->
            </div>
          </div>
          <div class="video-detail-section parent-tip">
            <h4>💡 家长贴士</h4>
            <p id="detail-parent-tip">给家长的建议</p>
          </div>
          <button class="btn-play-video" id="btn-play-detail" onclick="playVideoFromDetail()">
            ▶️ 播放视频
          </button>
        </div>
      </div>

      <!-- 数学游戏页 -->
      <section id="page-math" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')">← 返回</button>
          <h2>🔢 数学游戏</h2>
        </div>
        <div class="game-area">
          <div class="math-question">
            <span id="num1">3</span>
            <span id="operator">+</span>
            <span id="num2">2</span>
            <span>=</span>
            <span class="answer-box">?</span>
          </div>
          <div class="answer-options" id="math-options">
            <!-- 动态生成选项 -->
          </div>
          <div class="math-stats">
            <span>正确: <span id="math-correct">0</span></span>
            <span>连续答对: <span id="math-streak">0</span> 🔥</span>
          </div>
        </div>
      </section>

      <!-- 英语学习页 -->
      <section id="page-english" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')">← 返回</button>
          <h2>🔤 学英语</h2>
        </div>
        <div class="game-area">
          <div class="word-display">
            <div class="word-image" id="english-image">🍎</div>
            <div class="word-text" id="english-word">Apple</div>
            <button class="btn-sound" onclick="speakWord()">🔊 听发音</button>
          </div>
          <p class="question-text">这是什么?</p>
          <div class="answer-options" id="english-options">
            <!-- 动态生成选项 -->
          </div>
        </div>
      </section>

      <!-- 中文学习页 -->
      <section id="page-chinese" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')">← 返回</button>
          <h2>📝 学中文</h2>
        </div>
        <div class="game-area">
          <div class="character-display">
            <div class="big-character" id="chinese-char">大</div>
            <div class="pinyin" id="chinese-pinyin">dà</div>
          </div>
          <p class="question-text">选择正确的意思:</p>
          <div class="answer-options" id="chinese-options">
            <!-- 动态生成选项 -->
          </div>
        </div>
      </section>

      <!-- 科学探索页 -->
      <section id="page-science" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')">← 返回</button>
          <h2>🔬 科学探索</h2>
        </div>

        <!-- 主题选择界面 -->
        <div class="science-themes" id="science-themes">
          <p class="science-intro">选择你想探索的主题 🎯</p>
          <div class="theme-list" id="theme-list">
            <!-- 动态生成主题卡片 -->
          </div>
        </div>

        <!-- 答题界面 -->
        <div class="science-quiz hidden" id="science-quiz">
          <!-- 进度指示 -->
          <div class="quiz-progress">
            <span class="quiz-progress-text">第 <span id="science-current">1</span>/<span id="science-total">10</span> 题</span>
            <div class="quiz-progress-bar">
              <div class="quiz-progress-fill" id="science-progress-fill"></div>
            </div>
          </div>

          <!-- 题目区域 -->
          <div class="quiz-question-area">
            <div class="quiz-image" id="science-image">🦁</div>
            <div class="quiz-question-box">
              <h3 class="quiz-question" id="science-question">这是什么动物？</h3>
              <p class="quiz-hint" id="science-hint">它被称为"森林之王"</p>
            </div>
          </div>

          <!-- 选项区域 -->
          <div class="quiz-options" id="science-options">
            <!-- 动态生成选项 -->
          </div>

          <!-- 返回主题按钮 -->
          <button class="btn-back-themes" onclick="backToThemes()">← 返回主题选择</button>
        </div>
      </section>

      <!-- 科学答题反馈弹窗 -->
      <div id="science-feedback-modal" class="science-feedback-modal hidden">
        <div class="science-feedback-content">
          <div class="feedback-icon" id="science-feedback-icon">⭐</div>
          <h2 class="feedback-title" id="science-feedback-title">答对啦！</h2>
          <div class="feedback-answer" id="science-feedback-answer">🦁 狮子</div>
          <div class="feedback-knowledge">
            <h4 id="science-knowledge-title">💡 你知道吗？</h4>
            <p id="science-knowledge-text">狮子是唯一群居的猫科动物哦！</p>
          </div>
          <div class="feedback-points" id="science-feedback-points">+15 积分 🎉</div>
          <button class="btn-continue-science" id="btn-continue-science" onclick="continueScience()">继续探索 →</button>
        </div>
      </div>

      <!-- 科学主题完成弹窗 -->
      <div id="science-complete-modal" class="science-complete-modal hidden">
        <div class="science-complete-content">
          <div class="complete-stars">🌟⭐🌟</div>
          <h2 class="complete-title">主题完成！</h2>
          <div class="complete-stats">
            <div class="complete-stat">
              <span class="stat-num" id="science-correct-count">8</span>
              <span class="stat-label">答对</span>
            </div>
            <div class="complete-stat">
              <span class="stat-num" id="science-total-count">10</span>
              <span class="stat-label">总题数</span>
            </div>
          </div>
          <div class="complete-bonus" id="science-bonus">+50 积分奖励！🎊</div>
          <button class="btn-back-themes-complete" onclick="backToThemesFromComplete()">选择其他主题</button>
        </div>
      </div>

      <!-- 倒计时页面 -->
      <section id="page-timer" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')">← 返回</button>
          <h2>⏰ 玩耍倒计时</h2>
        </div>

        <div class="timer-container">
          <!-- 倒计时显示 -->
          <div class="timer-display" id="timer-display">
            <div class="timer-circle" id="timer-circle">
              <svg class="timer-svg" viewBox="0 0 200 200">
                <circle class="timer-bg" cx="100" cy="100" r="90"/>
                <circle class="timer-progress" id="timer-progress" cx="100" cy="100" r="90"/>
              </svg>
              <div class="timer-text">
                <span class="timer-minutes" id="timer-minutes">05</span>
                <span class="timer-colon">:</span>
                <span class="timer-seconds" id="timer-seconds">00</span>
              </div>
              <div class="timer-emoji" id="timer-emoji">🎮</div>
            </div>
          </div>

          <!-- 时间选择（未开始时显示） -->
          <div class="timer-setup" id="timer-setup">
            <p class="timer-hint">选择玩耍时间:</p>
            <div class="time-options">
              <button class="time-btn" onclick="setTimerMinutes(3)">
                <span class="time-num">3</span>
                <span class="time-unit">分钟</span>
              </button>
              <button class="time-btn active" onclick="setTimerMinutes(5)">
                <span class="time-num">5</span>
                <span class="time-unit">分钟</span>
              </button>
              <button class="time-btn" onclick="setTimerMinutes(10)">
                <span class="time-num">10</span>
                <span class="time-unit">分钟</span>
              </button>
              <button class="time-btn" onclick="setTimerMinutes(15)">
                <span class="time-num">15</span>
                <span class="time-unit">分钟</span>
              </button>
            </div>
            <button class="btn-start-timer" onclick="startTimer()">
              ▶️ 开始倒计时
            </button>
          </div>

          <!-- 控制按钮（运行中显示） -->
          <div class="timer-controls hidden" id="timer-controls">
            <button class="timer-control-btn btn-pause" id="btn-pause" onclick="togglePauseTimer()">
              ⏸️ 暂停
            </button>
            <button class="timer-control-btn btn-stop" onclick="stopTimer()">
              ⏹️ 结束
            </button>
          </div>

          <!-- 鼓励语 -->
          <div class="timer-message" id="timer-message">
            <p>玩得开心！时间到了要乖乖走哦~ 🌟</p>
          </div>
        </div>
      </section>

      <!-- 时间到弹窗 -->
      <div id="timer-finish-modal" class="timer-finish-modal hidden">
        <div class="timer-finish-content">
          <div class="finish-emoji">⏰</div>
          <h2 class="finish-title">时间到啦!</h2>
          <p class="finish-message">玩得开心吗？现在该回家咯~ 🏠</p>
          <div class="finish-animation">
            <span>🌈</span><span>⭐</span><span>🎉</span>
          </div>
          <button class="btn-finish-ok" onclick="closeTimerFinish()">
            好的，我知道了 👋
          </button>
        </div>
      </div>

      <!-- 个人信息页面 -->
      <section id="page-profile" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')">← 返回</button>
          <h2>👤 我的信息</h2>
        </div>

        <div class="profile-container">
          <!-- 头像区域 -->
          <div class="profile-avatar-section">
            <div class="avatar-wrapper" onclick="showPhotoOptions()">
              <img id="profile-avatar" class="profile-avatar" src="" alt="头像">
              <div class="avatar-placeholder" id="avatar-placeholder">
                <span>📷</span>
                <span class="avatar-hint">点击添加照片</span>
              </div>
              <div class="avatar-edit-icon">📷</div>
            </div>
          </div>

          <!-- 个人信息表单 -->
          <div class="profile-form">
            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">👶</span>
                <span>我的名字</span>
              </label>
              <input type="text" id="profile-name" class="form-input" placeholder="输入你的名字" maxlength="20">
            </div>

            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">🎂</span>
                <span>我的年龄</span>
              </label>
              <div class="age-selector">
                <button class="age-btn" onclick="changeAge(-1)">－</button>
                <span class="age-display" id="profile-age">6</span>
                <span class="age-unit">岁</span>
                <button class="age-btn" onclick="changeAge(1)">＋</button>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">🎈</span>
                <span>生日</span>
              </label>
              <input type="date" id="profile-birthday" class="form-input">
            </div>

            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">💖</span>
                <span>我喜欢的事情</span>
              </label>
              <div class="hobbies-grid" id="hobbies-grid">
                <button class="hobby-tag" data-hobby="画画" onclick="toggleHobby(this)">🎨 画画</button>
                <button class="hobby-tag" data-hobby="唱歌" onclick="toggleHobby(this)">🎤 唱歌</button>
                <button class="hobby-tag" data-hobby="跳舞" onclick="toggleHobby(this)">💃 跳舞</button>
                <button class="hobby-tag" data-hobby="运动" onclick="toggleHobby(this)">⚽ 运动</button>
                <button class="hobby-tag" data-hobby="看书" onclick="toggleHobby(this)">📚 看书</button>
                <button class="hobby-tag" data-hobby="积木" onclick="toggleHobby(this)">🧱 积木</button>
                <button class="hobby-tag" data-hobby="恐龙" onclick="toggleHobby(this)">🦖 恐龙</button>
                <button class="hobby-tag" data-hobby="动物" onclick="toggleHobby(this)">🐱 动物</button>
                <button class="hobby-tag" data-hobby="汽车" onclick="toggleHobby(this)">🚗 汽车</button>
                <button class="hobby-tag" data-hobby="公主" onclick="toggleHobby(this)">👸 公主</button>
                <button class="hobby-tag" data-hobby="太空" onclick="toggleHobby(this)">🚀 太空</button>
                <button class="hobby-tag" data-hobby="美食" onclick="toggleHobby(this)">🍰 美食</button>
              </div>
            </div>

            <button class="btn-save-profile" onclick="saveProfile()">
              💾 保存信息
            </button>
          </div>

          <!-- 数据管理区域 -->
          <div class="data-management">
            <h3 class="data-management-title">📦 数据管理</h3>
            <div class="data-btns">
              <button class="btn-export" onclick="exportData()">
                <span class="btn-icon">📤</span>
                <span>导出数据</span>
              </button>
              <button class="btn-import" onclick="triggerImport()">
                <span class="btn-icon">📥</span>
                <span>导入数据</span>
              </button>
              <button class="btn-refresh" onclick="forceRefresh()">
                <span class="btn-icon">🔄</span>
                <span>强制刷新</span>
              </button>
            </div>
            <p class="data-warning">⚠️ 导入数据会覆盖当前所有数据</p>
          </div>
        </div>
      </section>

      <!-- 照片选项弹窗 -->
      <div id="photo-options-modal" class="photo-options-modal hidden">
        <div class="photo-options-content">
          <h3>选择照片来源</h3>
          <div class="photo-options-buttons">
            <button class="photo-option-btn" onclick="takePhoto()">
              <span class="option-icon">📸</span>
              <span>拍照</span>
            </button>
            <button class="photo-option-btn" onclick="choosePhoto()">
              <span class="option-icon">🖼️</span>
              <span>从相册选择</span>
            </button>
          </div>
          <button class="photo-cancel-btn" onclick="closePhotoOptions()">取消</button>
        </div>
      </div>

      <!-- 导入确认弹窗 -->
      <div id="import-confirm-modal" class="confirm-modal hidden">
        <div class="confirm-modal-content">
          <div class="confirm-icon">⚠️</div>
          <h3 class="confirm-title">确认导入</h3>
          <p class="confirm-message">导入数据将覆盖当前所有数据，此操作不可撤销。</p>
          <div class="confirm-btns">
            <button class="btn-confirm-cancel" onclick="closeImportConfirm()">取消</button>
            <button class="btn-confirm-ok" onclick="confirmImport()">确认导入</button>
          </div>
        </div>
      </div>

      <!-- 隐藏的文件输入 -->
      <input type="file" id="photo-input-camera" accept="image/*" capture="user" style="display:none" onchange="handlePhotoSelect(event)">
      <input type="file" id="photo-input-gallery" accept="image/*" style="display:none" onchange="handlePhotoSelect(event)">
      <input type="file" id="import-file-input" accept=".json" style="display:none" onchange="handleImportFile(event)">

      <!-- 日历页 -->
      <section id="page-calendar" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')">← 返回</button>
          <h2>📅 我的日历</h2>
        </div>

        <!-- 月份切换 -->
        <div class="calendar-header">
          <button class="calendar-nav-btn" onclick="changeMonth(-1)">◀</button>
          <h3 id="calendar-month-title">2026年1月</h3>
          <button class="calendar-nav-btn" onclick="changeMonth(1)">▶</button>
        </div>

        <!-- 月度统计 -->
        <div class="calendar-stats">
          <div class="stat-item stat-class">
            <span class="stat-icon">📚</span>
            <span class="stat-value" id="stat-classes">0</span>
            <span class="stat-label">节课外班</span>
          </div>
          <div class="stat-item stat-play">
            <span class="stat-icon">🎡</span>
            <span class="stat-value" id="stat-outings">0</span>
            <span class="stat-label">次出去玩</span>
          </div>
          <div class="stat-item stat-holiday">
            <span class="stat-icon">🏖️</span>
            <span class="stat-value" id="stat-holidays">0</span>
            <span class="stat-label">天假期</span>
          </div>
        </div>

        <!-- 日历网格 -->
        <div class="calendar-container">
          <div class="calendar-weekdays">
            <span>日</span>
            <span>一</span>
            <span>二</span>
            <span>三</span>
            <span>四</span>
            <span>五</span>
            <span>六</span>
          </div>
          <div class="calendar-grid" id="calendar-grid">
            <!-- 日历日期由 JS 动态生成 -->
          </div>
        </div>

        <!-- 选中日期的事件列表 -->
        <div class="day-events" id="day-events">
          <div class="day-events-header">
            <h4 id="selected-date-title">今天</h4>
            <button class="btn-add-event" onclick="showAddEventModal()">+ 添加</button>
          </div>
          <div class="events-list" id="events-list">
            <p class="no-events">这一天还没有安排哦~</p>
          </div>
        </div>
      </section>

      <!-- 睡眠音乐页面 -->
      <section id="page-sleep-music" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')">← 返回</button>
          <h2>🎵 睡眠音乐</h2>
        </div>

        <!-- 播放器区域 -->
        <div class="sleep-music-player">
          <div class="player-disc-container">
            <div class="player-disc" id="player-disc">
              <div class="disc-center">🎵</div>
            </div>
          </div>
          <div class="player-info">
            <h3 class="player-song-name" id="player-song-name">选择一首音乐</h3>
            <p class="player-song-duration" id="player-song-duration">--:--</p>
          </div>
          <div class="player-controls">
            <button class="player-btn btn-stop-music" onclick="stopSleepMusic()" id="btn-stop-music" disabled>
              <span>⏹</span>
            </button>
            <button class="player-btn btn-play-music" onclick="toggleSleepMusic()" id="btn-play-music" disabled>
              <span id="play-icon">▶</span>
            </button>
          </div>
          <!-- 定时器显示 -->
          <div class="sleep-timer-display" id="sleep-timer-display">
            <span class="timer-icon">⏰</span>
            <span class="timer-remaining" id="timer-remaining">--:--</span>
          </div>
        </div>

        <!-- 定时器选项 -->
        <div class="sleep-timer-section">
          <h4 class="section-title">⏰ 定时关闭</h4>
          <div class="sleep-timer-options">
            <button class="sleep-timer-btn" data-minutes="0" onclick="setSleepTimer(0)">
              <span class="timer-value">不限</span>
            </button>
            <button class="sleep-timer-btn active" data-minutes="15" onclick="setSleepTimer(15)">
              <span class="timer-value">15</span>
              <span class="timer-unit">分钟</span>
            </button>
            <button class="sleep-timer-btn" data-minutes="30" onclick="setSleepTimer(30)">
              <span class="timer-value">30</span>
              <span class="timer-unit">分钟</span>
            </button>
            <button class="sleep-timer-btn" data-minutes="45" onclick="setSleepTimer(45)">
              <span class="timer-value">45</span>
              <span class="timer-unit">分钟</span>
            </button>
            <button class="sleep-timer-btn" data-minutes="60" onclick="setSleepTimer(60)">
              <span class="timer-value">60</span>
              <span class="timer-unit">分钟</span>
            </button>
          </div>
        </div>

        <!-- 音乐列表 -->
        <div class="sleep-music-list">
          <h4 class="section-title">🎶 选择音乐</h4>
          <div class="music-cards" id="music-cards">
            <!-- 动态生成音乐卡片 -->
          </div>
        </div>
      </section>

      <!-- 拼图游戏页面 -->
      <section id="page-puzzle" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')">← 返回</button>
          <h2>🧩 拼图游戏</h2>
        </div>

        <!-- 选择界面 -->
        <div class="puzzle-select" id="puzzle-select">
          <!-- 难度选择 -->
          <div class="puzzle-section">
            <h3 class="puzzle-section-title">选择难度</h3>
            <div class="difficulty-selector" id="difficulty-selector">
              <!-- 动态生成难度选项 -->
            </div>
          </div>

          <!-- 主题选择 -->
          <div class="puzzle-section">
            <h3 class="puzzle-section-title">选择主题</h3>
            <div class="theme-selector" id="puzzle-theme-selector">
              <!-- 动态生成主题选项 -->
            </div>
          </div>

          <!-- 图片选择 -->
          <div class="puzzle-section">
            <h3 class="puzzle-section-title">选择图片</h3>
            <div class="image-selector" id="puzzle-image-selector">
              <!-- 动态生成图片选项 -->
            </div>
          </div>
        </div>

        <!-- 游戏界面 -->
        <div class="puzzle-game hidden" id="puzzle-game">
          <!-- 游戏控制栏 -->
          <div class="puzzle-controls">
            <button class="puzzle-control-btn" onclick="showPuzzleHint()">
              <span>👁</span>
              <span>提示</span>
            </button>
            <div class="puzzle-timer">
              <span>⏱</span>
              <span id="puzzle-time">00:00</span>
            </div>
            <button class="puzzle-control-btn" onclick="restartPuzzle()">
              <span>🔄</span>
              <span>重开</span>
            </button>
          </div>

          <!-- 原图参考（小图） -->
          <div class="puzzle-reference">
            <div class="reference-image" id="puzzle-reference-image">🦁</div>
            <span class="reference-label">原图参考</span>
          </div>

          <!-- 拼图板 -->
          <div class="puzzle-board-container">
            <div class="puzzle-board" id="puzzle-board">
              <!-- 动态生成拼图槽位 -->
            </div>
          </div>

          <!-- 碎片区 -->
          <div class="puzzle-pieces-container">
            <p class="pieces-hint">拖动碎片到上方拼图板</p>
            <div class="puzzle-pieces" id="puzzle-pieces">
              <!-- 动态生成碎片 -->
            </div>
          </div>

          <!-- 返回选择按钮 -->
          <button class="btn-back-select" onclick="backToPuzzleSelect()">← 返回选择</button>
        </div>
      </section>
    </main>

  <!-- ========== P0功能弹窗 ========== -->

  <!-- 成就列表弹窗 -->
  <div id="achievements-modal" class="achievements-modal hidden">
    <div class="achievements-modal-content">
      <button class="modal-close-btn" onclick="closeAchievements()">✕</button>
      <h2 class="achievements-modal-title">🏆 我的成就</h2>
      <div id="achievements-list" class="achievements-list">
        <!-- 动态生成 -->
      </div>
    </div>
  </div>

  <!-- 成就解锁弹窗 -->
  <div id="achievement-unlock-modal" class="achievement-unlock-modal hidden">
    <div class="achievement-unlock-content">
      <div class="unlock-celebration">🎉</div>
      <div class="unlock-title">成就解锁!</div>
      <div class="unlock-icon" id="unlock-achievement-icon">🏆</div>
      <div class="unlock-name" id="unlock-achievement-name">成就名称</div>
      <div class="unlock-desc" id="unlock-achievement-desc">成就描述</div>
      <button class="btn-unlock-close" onclick="closeAchievementUnlock()">太棒了!</button>
    </div>
  </div>

  <!-- 错题本列表弹窗 -->
  <div id="wrong-questions-modal" class="wrong-questions-modal hidden">
    <div class="wrong-questions-modal-content">
      <button class="modal-close-btn" onclick="closeWrongQuestions()">✕</button>
      <h2 class="wq-modal-title">📕 错题本</h2>
      <div id="wrong-questions-list" class="wrong-questions-list">
        <!-- 动态生成 -->
      </div>
    </div>
  </div>

  <!-- 错题详情弹窗 -->
  <div id="wrong-question-detail-modal" class="wrong-question-detail-modal hidden">
    <div class="wqd-modal-content">
      <button class="modal-close-btn" onclick="closeWrongQuestionDetail()">✕</button>
      <div id="wrong-question-detail-content">
        <!-- 动态生成 -->
      </div>
    </div>
  </div>

  <!-- 复习题目弹窗 -->
  <div id="review-question-modal" class="review-question-modal hidden">
    <div class="review-modal-content">
      <button class="modal-close-btn" onclick="closeReviewQuestion()">✕</button>
      <div id="review-question-content">
        <!-- 动态生成 -->
      </div>
    </div>
  </div>

  <!-- 签到页面弹窗 -->
  <div id="checkin-modal" class="checkin-modal hidden">
    <div class="checkin-modal-content">
      <button class="modal-close-btn" onclick="closeCheckin()">✕</button>
      <h2 class="checkin-modal-title">📅 每日签到</h2>
      <div id="checkin-stats" class="checkin-stats">
        <!-- 动态生成 -->
      </div>
      <div id="checkin-calendar" class="checkin-calendar">
        <!-- 动态生成 -->
      </div>
    </div>
  </div>

  <!-- 签到提醒弹窗 -->
  <div id="checkin-reminder-modal" class="checkin-reminder-modal hidden">
    <div class="checkin-reminder-content">
      <div class="reminder-header">
        <span class="reminder-star">⭐</span>
        <span class="reminder-title">今日签到</span>
        <span class="reminder-star">⭐</span>
      </div>
      <div class="reminder-reward">
        <span class="reminder-icon" id="checkin-reward-icon">🌟</span>
        <span class="reminder-points" id="checkin-reward-points">+5分</span>
      </div>
      <div class="reminder-streak" id="checkin-streak-info">开始你的签到之旅吧!</div>
      <div class="reminder-actions">
        <button class="btn-checkin-now" onclick="doCheckinFromReminder()">立即签到</button>
        <button class="btn-checkin-later" onclick="closeCheckinReminder()">稍后再说</button>
      </div>
    </div>
  </div>

  <!-- 签到成功弹窗 -->
  <div id="checkin-success-modal" class="checkin-success-modal hidden">
    <div class="checkin-success-content">
      <div class="success-icon" id="checkin-success-icon">🌟</div>
      <div class="success-title">签到成功!</div>
      <div class="success-points" id="checkin-success-points">+5分</div>
      <div class="success-streak" id="checkin-success-streak">连续签到 1 天</div>
      <div class="success-badge hidden" id="checkin-success-badge"></div>
      <button class="btn-success-close" onclick="closeCheckinSuccess()">继续加油!</button>
    </div>
  </div>

  <!-- ========== P1功能弹窗 ========== -->

  <!-- 记忆游戏选择弹窗 -->
  <div id="memory-game-modal" class="memory-game-modal hidden">
    <div class="memory-game-modal-content">
      <button class="modal-close-btn" onclick="closeMemoryGame()">✕</button>
      <h2 class="memory-game-title">🧠 记忆训练</h2>
      <div id="memory-game-select" class="memory-game-select">
        <!-- 游戏类型选择 -->
      </div>
      <div id="memory-game-area" class="memory-game-area hidden">
        <!-- 游戏区域 -->
      </div>
    </div>
  </div>

  <!-- 记忆游戏结果弹窗 -->
  <div id="memory-result-modal" class="memory-result-modal hidden">
    <div class="memory-result-content">
      <div class="memory-result-icon" id="memory-result-icon">🎉</div>
      <div class="memory-result-title" id="memory-result-title">太棒了!</div>
      <div class="memory-result-stats" id="memory-result-stats">
        <!-- 游戏统计 -->
      </div>
      <div class="memory-result-points" id="memory-result-points">+20 积分</div>
      <div class="memory-result-actions">
        <button class="btn-memory-again" onclick="restartMemoryGame()">再玩一次</button>
        <button class="btn-memory-back" onclick="backToMemorySelect()">返回选择</button>
      </div>
    </div>
  </div>

  <!-- 学习宠物弹窗 -->
  <div id="learning-pet-modal" class="learning-pet-modal hidden">
    <div class="learning-pet-modal-content">
      <button class="modal-close-btn" onclick="closeLearningPet()">✕</button>
      <h2 class="learning-pet-title">🐱 我的学习宠物</h2>

      <!-- 宠物选择界面（首次使用） -->
      <div id="pet-select-area" class="pet-select-area hidden">
        <p class="pet-select-hint">选择你的学习伙伴:</p>
        <div id="pet-type-list" class="pet-type-list">
          <!-- 宠物类型选择 -->
        </div>
        <input type="text" id="pet-name-input" class="pet-name-input" placeholder="给宠物起个名字..." maxlength="10">
        <button class="btn-adopt-pet" onclick="adoptPet()">领养宠物</button>
      </div>

      <!-- 宠物主界面 -->
      <div id="pet-main-area" class="pet-main-area hidden">
        <!-- 宠物展示 -->
        <div class="pet-display-area">
          <div class="pet-stage-badge" id="pet-stage-badge">蛋</div>
          <div class="pet-avatar" id="pet-avatar">🥚</div>
          <div class="pet-name" id="pet-display-name">小宠物</div>
        </div>

        <!-- 宠物状态条 -->
        <div class="pet-status-bars">
          <div class="pet-status-bar">
            <span class="status-label">💖 幸福度</span>
            <div class="status-bar-bg">
              <div class="status-bar-fill happiness-fill" id="happiness-fill"></div>
            </div>
            <span class="status-value" id="happiness-value">100</span>
          </div>
          <div class="pet-status-bar">
            <span class="status-label">🍖 饱食度</span>
            <div class="status-bar-bg">
              <div class="status-bar-fill hunger-fill" id="hunger-fill"></div>
            </div>
            <span class="status-value" id="hunger-value">100</span>
          </div>
          <div class="pet-status-bar">
            <span class="status-label">⭐ 经验值</span>
            <div class="status-bar-bg">
              <div class="status-bar-fill exp-fill" id="exp-fill"></div>
            </div>
            <span class="status-value" id="exp-value">0/100</span>
          </div>
        </div>

        <!-- 宠物操作按钮 -->
        <div class="pet-actions">
          <button class="pet-action-btn" onclick="showPetFeed()">
            <span class="action-icon">🍖</span>
            <span>喂食</span>
          </button>
          <button class="pet-action-btn" onclick="petPet()">
            <span class="action-icon">🤗</span>
            <span>抚摸</span>
          </button>
          <button class="pet-action-btn" onclick="showPetAccessories()">
            <span class="action-icon">🎀</span>
            <span>装扮</span>
          </button>
        </div>

        <!-- 宠物消息 -->
        <div class="pet-message" id="pet-message">
          <span class="message-text">今天也要好好学习哦！</span>
        </div>
      </div>
    </div>
  </div>

  <!-- 喂食菜单弹窗 -->
  <div id="pet-feed-modal" class="pet-feed-modal hidden">
    <div class="pet-feed-content">
      <button class="modal-close-btn" onclick="closePetFeed()">✕</button>
      <h3>🍖 喂食</h3>
      <div id="food-list" class="food-list">
        <!-- 食物列表 -->
      </div>
    </div>
  </div>

  <!-- 装扮菜单弹窗 -->
  <div id="pet-accessories-modal" class="pet-accessories-modal hidden">
    <div class="pet-accessories-content">
      <button class="modal-close-btn" onclick="closePetAccessories()">✕</button>
      <h3>🎀 装扮</h3>
      <div id="accessories-list" class="accessories-list">
        <!-- 配饰列表 -->
      </div>
    </div>
  </div>

  <!-- 宠物进化弹窗 -->
  <div id="pet-evolution-modal" class="pet-evolution-modal hidden">
    <div class="pet-evolution-content">
      <div class="evolution-celebration">✨</div>
      <div class="evolution-title">宠物进化了!</div>
      <div class="evolution-stages">
        <span class="old-stage" id="old-pet-stage">🥚</span>
        <span class="evolution-arrow">→</span>
        <span class="new-stage" id="new-pet-stage">🐱</span>
      </div>
      <div class="evolution-name" id="evolution-stage-name">幼年期</div>
      <button class="btn-evolution-close" onclick="closePetEvolution()">太棒了!</button>
    </div>
  </div>

  <!-- 学习报告弹窗 -->
  <div id="learning-report-modal" class="learning-report-modal hidden">
    <div class="learning-report-modal-content">
      <button class="modal-close-btn" onclick="closeLearningReport()">✕</button>

      <!-- 报告周期选择 -->
      <div class="report-period-selector">
        <button class="report-period-btn active" data-period="week" onclick="changeReportPeriod('week')">本周</button>
        <button class="report-period-btn" data-period="month" onclick="changeReportPeriod('month')">本月</button>
        <button class="report-period-btn" data-period="all" onclick="changeReportPeriod('all')">全部</button>
      </div>

      <!-- 报告内容 -->
      <div id="learning-report-content" class="learning-report-content">
        <!-- 动态生成 -->
      </div>

      <!-- 分享按钮 -->
      <button class="btn-share-report" onclick="shareReport()">📤 分享报告</button>
    </div>
  </div>

  <!-- P2: 绘本阅读弹窗 -->
  <div id="picture-book-modal" class="picture-book-modal hidden">
    <div class="picture-book-content">
      <button class="modal-close-btn" onclick="closePictureBook()">✕</button>

      <!-- 书架选择区域 -->
      <div id="book-select-area" class="book-select-area">
        <div class="bookshelf-header">
          <h2>📚 绘本故事</h2>
          <div class="bookshelf-tabs" id="bookshelf-tabs">
            <!-- 动态生成分类标签 -->
          </div>
        </div>
        <div id="bookshelf-grid" class="bookshelf-grid">
          <!-- 动态生成书籍 -->
        </div>
      </div>

      <!-- 阅读区域 -->
      <div id="book-read-area" class="book-read-area hidden">
        <div class="book-reader-header">
          <button class="btn-back-shelf" onclick="backToBookshelf()">← 返回书架</button>
          <h3 id="current-book-title">故事标题</h3>
          <button class="btn-toggle-auto" id="btn-auto-read" onclick="toggleAutoRead()">🔊 自动朗读</button>
        </div>

        <div class="book-page-container">
          <div class="book-page" id="book-page">
            <div class="page-illustration" id="page-illustration">📖</div>
            <div class="page-text" id="page-text">故事内容...</div>
          </div>
        </div>

        <div class="book-controls">
          <button class="btn-page-nav" id="btn-prev-page" onclick="prevBookPage()">◀ 上一页</button>
          <span class="page-indicator" id="page-indicator">1 / 5</span>
          <button class="btn-page-nav" id="btn-next-page" onclick="nextBookPage()">下一页 ▶</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 绘本完成弹窗 -->
  <div id="book-complete-modal" class="book-complete-modal hidden">
    <div class="book-complete-content">
      <div class="complete-celebration">🎉</div>
      <div class="complete-title">读完啦！</div>
      <div class="complete-book-name" id="completed-book-name">三只小猪</div>
      <div class="complete-message">你真棒！又读完一本故事书！</div>
      <div class="complete-reward">
        <span class="reward-icon">⭐</span>
        <span class="reward-text">+10 积分</span>
      </div>
      <div class="complete-actions">
        <button class="btn-read-again" onclick="readBookAgain()">再读一遍</button>
        <button class="btn-back-books" onclick="closeBookComplete()">返回书架</button>
      </div>
    </div>
  </div>

  <!-- P2: 跟读练习弹窗 -->
  <div id="pronunciation-modal" class="pronunciation-modal hidden">
    <div class="pronunciation-content">
      <button class="modal-close-btn" onclick="closePronunciation()">✕</button>

      <!-- 练习类型选择 -->
      <div id="pronunciation-select-area" class="pronunciation-select-area">
        <h2>🎤 跟读练习</h2>
        <div class="pronunciation-types" id="pronunciation-types">
          <!-- 动态生成练习类型 -->
        </div>
        <div class="pronunciation-stats" id="pronunciation-stats">
          <!-- 练习统计 -->
        </div>
      </div>

      <!-- 练习区域 -->
      <div id="pronunciation-practice-area" class="pronunciation-practice-area hidden">
        <div class="practice-header">
          <button class="btn-back-select" onclick="backToPronunciationSelect()">← 返回</button>
          <h3 id="practice-type-title">拼音练习</h3>
          <span class="practice-progress" id="practice-progress">1 / 10</span>
        </div>

        <div class="practice-main">
          <div class="practice-target">
            <div class="target-text" id="target-text">妈妈</div>
            <div class="target-pinyin" id="target-pinyin">mā ma</div>
          </div>

          <div class="practice-demo">
            <button class="btn-demo-play" id="btn-demo-play" onclick="playDemonstration()">
              🔊 听示范
            </button>
          </div>

          <div class="practice-record">
            <button class="btn-record" id="btn-record" onclick="toggleRecording()">
              <span class="record-icon">🎙️</span>
              <span class="record-text">点击录音</span>
            </button>
            <div class="record-status" id="record-status">准备好了</div>
          </div>

          <div class="practice-result hidden" id="practice-result">
            <div class="result-score" id="result-score">90</div>
            <div class="result-label">分</div>
            <div class="result-feedback" id="result-feedback">非常棒！</div>
            <div class="result-recognized" id="result-recognized">识别结果: 妈妈</div>
          </div>
        </div>

        <div class="practice-actions">
          <button class="btn-try-again" id="btn-try-again" onclick="tryAgain()">再试一次</button>
          <button class="btn-next-item" id="btn-next-item" onclick="nextPracticeItem()">下一个 ▶</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 跟读完成弹窗 -->
  <div id="pronunciation-complete-modal" class="pronunciation-complete-modal hidden">
    <div class="pronunciation-complete-content">
      <div class="complete-celebration">🎉</div>
      <div class="complete-title">练习完成!</div>
      <div class="complete-summary">
        <div class="summary-item">
          <span class="summary-label">练习数量</span>
          <span class="summary-value" id="summary-count">10</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">平均得分</span>
          <span class="summary-value" id="summary-avg-score">85</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">最高得分</span>
          <span class="summary-value" id="summary-max-score">95</span>
        </div>
      </div>
      <div class="complete-reward">
        <span class="reward-icon">⭐</span>
        <span class="reward-text" id="pronunciation-reward">+15 积分</span>
      </div>
      <button class="btn-pronunciation-done" onclick="closePronunciationComplete()">太棒了!</button>
    </div>
  </div>


    <!-- 底部导航 -->
    <nav class="bottom-nav">
      <div class="nav-item active" onclick="navigateTo('home')">
        <span class="nav-icon">🏠</span>
        <span class="nav-label">首页</span>
      </div>
      <div class="nav-item" onclick="navigateTo('home'); filterHomeCards('learn')">
        <span class="nav-icon">📚</span>
        <span class="nav-label">学习</span>
      </div>
      <div class="nav-item" onclick="navigateTo('home'); filterHomeCards('play')">
        <span class="nav-icon">🎮</span>
        <span class="nav-label">游戏</span>
      </div>
      <div class="nav-item" onclick="navigateTo('home'); filterHomeCards('tools')">
        <span class="nav-icon">🔧</span>
        <span class="nav-label">工具</span>
      </div>
      <div class="nav-item" onclick="navigateTo('profile')">
        <span class="nav-icon">👤</span>
        <span class="nav-label">我的</span>
      </div>
    </nav>
  </div>

  <!-- AI聊天入口按钮（悬浮） -->
  <button id="ai-chat-fab" class="ai-chat-fab" onclick="openAIChat()">
    <span class="fab-icon">🤖</span>
    <span class="fab-text">小助手</span>
  </button>

  <!-- AI聊天弹窗 -->
  <div id="ai-chat-modal" class="ai-chat-modal hidden">
    <div class="ai-chat-container">
      <!-- 头部 -->
      <div class="ai-chat-header">
        <div class="ai-chat-title">
          <span>🤖</span>
          <span>学习小助手</span>
        </div>
        <div class="ai-chat-actions">
          <button onclick="clearAIChat()" title="清空聊天">🗑️</button>
          <button onclick="closeAIChat()">✕</button>
        </div>
      </div>

      <!-- 下载确认界面 -->
      <div id="ai-chat-download-prompt" class="ai-chat-state hidden">
        <div class="download-prompt-content">
          <span class="prompt-icon">🤖</span>
          <h3>启用AI小助手</h3>
          <p>需要下载约 <strong>300MB</strong> 的数据</p>
          <p class="prompt-note">下载后可以离线使用哦~</p>
          <div class="download-buttons">
            <button class="btn-download-start" onclick="startAIModelDownload()">
              开始下载
            </button>
            <button class="btn-download-cancel" onclick="closeAIChat()">
              以后再说
            </button>
          </div>
        </div>
      </div>

      <!-- 加载中界面 -->
      <div id="ai-chat-loading" class="ai-chat-state hidden">
        <div class="loading-content">
          <span class="loading-icon">🤖</span>
          <h3>小助手正在准备中...</h3>
          <div class="loading-bar">
            <div class="loading-bar-fill" id="ai-loading-bar-fill"></div>
          </div>
          <p class="loading-percent"><span id="ai-loading-percent">0</span>%</p>
          <div class="loading-fun-fact" id="ai-loading-fact">
            💡 小知识：大象是陆地上最大的动物哦！
          </div>
        </div>
      </div>

      <!-- 主聊天界面 -->
      <div id="ai-chat-main" class="ai-chat-main hidden">
        <!-- 消息区域 -->
        <div class="ai-chat-messages" id="ai-chat-messages">
          <div class="chat-welcome">
            <span class="welcome-emoji">🤖</span>
            <p>你好呀！我是学习小助手~</p>
            <p>有什么想问我的吗？</p>
          </div>
        </div>

        <!-- 预设问题 -->
        <div class="ai-preset-questions">
          <button onclick="usePresetQuestion('给我讲个小故事')">📖 讲故事</button>
          <button onclick="usePresetQuestion('为什么天是蓝色的')">🌤️ 为什么</button>
          <button onclick="usePresetQuestion('1+1等于多少')">🔢 数学题</button>
          <button onclick="usePresetQuestion('苹果用英语怎么说')">🍎 学英语</button>
        </div>

        <!-- 输入区域 -->
        <div class="ai-chat-input-area">
          <input
            type="text"
            id="ai-chat-input"
            placeholder="输入你想问的问题..."
            onkeypress="if(event.key==='Enter')sendAIMessage()"
          >
          <button class="btn-send" onclick="sendAIMessage()">
            发送 ✨
          </button>
        </div>
      </div>

      <!-- 错误/不支持界面 -->
      <div id="ai-chat-error" class="ai-chat-state hidden">
        <div class="error-content">
          <span class="error-icon">😢</span>
          <p id="ai-error-message">暂不支持</p>
          <button onclick="closeAIChat()">知道了</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 睡眠音乐播放器 -->
  <audio id="sleep-audio" preload="auto" playsinline loop>
    <source id="sleep-audio-source" src="" type="audio/mpeg">
  </audio>

  <!-- PWA 更新提示 -->
  <div id="update-notification" class="update-notification hidden">
    <div class="update-content">
      <span class="update-icon">🎉</span>
      <span class="update-text">发现新版本！</span>
      <button class="update-btn" onclick="applyUpdate()">立即更新</button>
      <button class="update-close" onclick="hideUpdateNotification()">✕</button>
    </div>
  </div>

  <!-- Puter.js for AI TTS -->
  <script src="https://js.puter.com/v2/"></script>

  <script src="js/scienceData.js"></script>
  <script src="js/puzzleData.js"></script>
  <script src="js/rewards.js"></script>
  <script src="js/achievements.js"></script>
  <script src="js/wrongQuestions.js"></script>
  <script src="js/dailyCheckin.js"></script>
  <script src="js/memoryGame.js"></script>
  <script src="js/learningPet.js"></script>
  <script src="js/learningReport.js"></script>
  <script src="js/pictureBook.js"></script>
  <script src="js/pronunciation.js"></script>
  <script src="js/videos.js"></script>
  <script src="js/puzzle.js"></script>
  <script src="js/aiChat.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
