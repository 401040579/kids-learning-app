<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RCEWX2DDQQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-RCEWX2DDQQ');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#FF69B4">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.svg">
  <title>宝贝学习乐园</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- 星星/彩带飘落效果容器 -->
  <div id="particles"></div>

  <!-- 奖励弹窗 -->
  <div id="reward-popup" class="reward-popup hidden">
    <div class="reward-content">
      <div class="reward-stars">⭐⭐⭐</div>
      <h2 class="reward-title" data-i18n="reward.title">太棒了!</h2>
      <p class="reward-message" id="reward-message">你获得了 <span id="reward-points">10</span> 分!</p>
      <div class="reward-animation"></div>
      <button class="btn-continue" onclick="closeReward()" data-i18n="reward.continue">继续学习</button>
    </div>
  </div>

  <!-- 拼图完成弹窗 -->
  <div id="puzzle-complete-modal" class="puzzle-complete-modal hidden">
    <div class="puzzle-complete-content">
      <div class="complete-celebration">🎉</div>
      <h2 class="puzzle-complete-title" data-i18n="puzzle.complete">拼图完成!</h2>
      <div class="puzzle-complete-image" id="puzzle-complete-image">🦁</div>
      <div class="puzzle-complete-stats">
        <div class="complete-stat-item">
          <span class="stat-icon">⏱</span>
          <span class="stat-value" id="puzzle-complete-time">01:23</span>
          <span class="stat-label" data-i18n="puzzle.time">用时</span>
        </div>
        <div class="complete-stat-item">
          <span class="stat-icon">⭐</span>
          <span class="stat-value" id="puzzle-complete-points">+20</span>
          <span class="stat-label" data-i18n="puzzle.points">积分</span>
        </div>
      </div>
      <div class="puzzle-complete-buttons">
        <button class="btn-puzzle-again" onclick="restartPuzzle()" data-i18n="puzzle.playAgain">再玩一次</button>
        <button class="btn-puzzle-new" onclick="backToPuzzleSelect()" data-i18n="puzzle.newPuzzle">换一张</button>
      </div>
    </div>
  </div>

  <!-- 拼图提示弹窗 -->
  <div id="puzzle-hint-modal" class="puzzle-hint-modal hidden">
    <div class="puzzle-hint-content">
      <button class="puzzle-hint-close" onclick="closePuzzleHint()">✕</button>
      <h3 data-i18n="puzzle.hint">原图参考</h3>
      <div class="puzzle-hint-image" id="puzzle-hint-image">🦁</div>
      <p class="puzzle-hint-name" id="puzzle-hint-name">狮子</p>
    </div>
  </div>

  <!-- 视频播放器弹窗 -->
  <div id="video-modal" class="video-modal hidden">
    <div class="video-container">
      <button class="video-close" onclick="closeVideo()">✕</button>
      <div id="video-player"></div>
      <div id="video-overlay" class="video-overlay hidden">
        <div class="overlay-content">
          <span class="overlay-emoji">🌟</span>
          <p data-i18n="videos.ended">视频看完啦!</p>
          <button class="btn-primary" onclick="closeVideo()" data-i18n="videos.return">返回</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 添加事件弹窗 -->
  <div id="add-event-modal" class="event-modal hidden">
    <div class="event-modal-content">
      <button class="event-modal-close" onclick="closeAddEventModal()">✕</button>
      <h3 class="event-modal-title">添加新事件</h3>

      <!-- 事件类型选择 -->
      <div class="event-type-selector">
        <button class="event-type-btn active" data-type="class" onclick="selectEventType('class')">
          <span class="type-icon">📚</span>
          <span class="type-name">课外班</span>
        </button>
        <button class="event-type-btn" data-type="outing" onclick="selectEventType('outing')">
          <span class="type-icon">🎡</span>
          <span class="type-name">出去玩</span>
        </button>
        <button class="event-type-btn" data-type="holiday" onclick="selectEventType('holiday')">
          <span class="type-icon">🏖️</span>
          <span class="type-name">放假</span>
        </button>
        <button class="event-type-btn" data-type="study" onclick="selectEventType('study')">
          <span class="type-icon">📖</span>
          <span class="type-name">学习</span>
        </button>
      </div>

      <!-- 事件表单 -->
      <form id="event-form" class="event-form">
        <div class="form-group">
          <label>事件名称</label>
          <input type="text" id="event-name" placeholder="例如：钢琴课、去动物园" required>
        </div>

        <!-- 课外班专属：课程类型 -->
        <div class="form-group class-only">
          <label>课程类型</label>
          <div class="class-type-selector" id="class-type-selector">
            <button type="button" class="class-type-btn active" data-class="piano" onclick="selectClassType('piano')">🎹 钢琴</button>
            <button type="button" class="class-type-btn" data-class="art" onclick="selectClassType('art')">🎨 画画</button>
            <button type="button" class="class-type-btn" data-class="swim" onclick="selectClassType('swim')">🏊 游泳</button>
            <button type="button" class="class-type-btn" data-class="dance" onclick="selectClassType('dance')">💃 舞蹈</button>
            <button type="button" class="class-type-btn" data-class="english" onclick="selectClassType('english')">🔤 英语</button>
            <button type="button" class="class-type-btn" data-class="math" onclick="selectClassType('math')">🔢 数学</button>
            <button type="button" class="class-type-btn" data-class="sports" onclick="selectClassType('sports')">⚽ 运动</button>
            <button type="button" class="class-type-btn" data-class="other" onclick="selectClassType('other')">📝 其他</button>
          </div>
        </div>

        <!-- 时间设置（课外班和学习专属） -->
        <div class="form-group time-group class-only">
          <label>上课时间</label>
          <div class="time-inputs">
            <input type="time" id="event-start-time" value="09:00">
            <span>到</span>
            <input type="time" id="event-end-time" value="10:00">
          </div>
        </div>

        <!-- 重复设置 -->
        <div class="form-group class-only">
          <label>重复</label>
          <div class="repeat-selector">
            <button type="button" class="repeat-btn active" data-repeat="none" onclick="selectRepeat('none')">不重复</button>
            <button type="button" class="repeat-btn" data-repeat="weekly" onclick="selectRepeat('weekly')">每周重复</button>
          </div>
        </div>

        <!-- 备注 -->
        <div class="form-group">
          <label>备注 (选填)</label>
          <textarea id="event-note" placeholder="可以写一些备注..."></textarea>
        </div>

        <button type="submit" class="btn-submit-event">保存事件</button>
      </form>
    </div>
  </div>

  <!-- 事件详情/评价弹窗 -->
  <div id="event-detail-modal" class="event-modal hidden">
    <div class="event-modal-content">
      <button class="event-modal-close" onclick="closeEventDetailModal()">✕</button>

      <div class="event-detail-header">
        <span class="event-detail-icon" id="event-detail-icon">📚</span>
        <div class="event-detail-info">
          <h3 id="event-detail-name">钢琴课</h3>
          <p id="event-detail-time">09:00 - 10:00</p>
        </div>
      </div>

      <div class="event-detail-date" id="event-detail-date">2026年1月20日</div>

      <!-- 备注显示 -->
      <div class="event-detail-note" id="event-detail-note-section">
        <h4>📝 备注</h4>
        <p id="event-detail-note">无</p>
      </div>

      <!-- 心情评价（仅已完成的课外班显示） -->
      <div class="event-mood-section" id="event-mood-section">
        <h4>这次课感觉怎么样?</h4>
        <div class="mood-selector">
          <button class="mood-btn" data-mood="happy" onclick="selectMood('happy')">
            <span class="mood-emoji">😊</span>
            <span class="mood-text">开心</span>
          </button>
          <button class="mood-btn" data-mood="neutral" onclick="selectMood('neutral')">
            <span class="mood-emoji">😐</span>
            <span class="mood-text">一般</span>
          </button>
          <button class="mood-btn" data-mood="sad" onclick="selectMood('sad')">
            <span class="mood-emoji">😢</span>
            <span class="mood-text">不开心</span>
          </button>
          <button class="mood-btn" data-mood="tired" onclick="selectMood('tired')">
            <span class="mood-emoji">😫</span>
            <span class="mood-text">好累</span>
          </button>
          <button class="mood-btn" data-mood="excited" onclick="selectMood('excited')">
            <span class="mood-emoji">🤩</span>
            <span class="mood-text">超棒</span>
          </button>
        </div>

        <!-- 感受记录 -->
        <div class="feeling-input">
          <label>写写你的感受吧:</label>
          <textarea id="event-feeling" placeholder="今天学了什么? 有趣吗?"></textarea>
        </div>

        <button class="btn-save-mood" onclick="saveMoodAndFeeling()">保存心情</button>
      </div>

      <!-- 已保存的心情显示 -->
      <div class="saved-mood-display hidden" id="saved-mood-display">
        <h4>我的心情记录</h4>
        <div class="saved-mood-content">
          <span class="saved-mood-emoji" id="saved-mood-emoji">😊</span>
          <p class="saved-mood-feeling" id="saved-mood-feeling">很开心!</p>
        </div>
      </div>

      <!-- 操作按钮 -->
      <div class="event-actions">
        <button class="btn-delete-event" onclick="deleteEvent()">🗑️ 删除</button>
      </div>
    </div>
  </div>

  <!-- 主应用 -->
  <div id="app">
    <!-- 顶部状态栏 -->
    <header class="header">
      <div class="header-left">
        <span class="app-title">🌈 <span data-i18n="app.title">学习乐园</span></span>
      </div>
      <div class="header-right">
        <div class="score-display">
          <span class="star-icon">⭐</span>
          <span id="total-score">0</span>
        </div>
        <button class="lang-switch-btn" id="header-lang-btn" onclick="toggleLanguageDropdown()">
          <span class="lang-icon">🌐</span>
          <span class="lang-code" id="current-lang-code">EN</span>
        </button>
        <div class="lang-dropdown hidden" id="lang-dropdown">
          <button class="lang-option" data-lang="en" onclick="selectLanguage('en')">English</button>
          <button class="lang-option" data-lang="zh" onclick="selectLanguage('zh')">中文</button>
          <button class="lang-option" data-lang="ja" onclick="selectLanguage('ja')">日本語</button>
          <button class="lang-option" data-lang="ko" onclick="selectLanguage('ko')">한국어</button>
          <button class="lang-option" data-lang="es" onclick="selectLanguage('es')">Español</button>
          <button class="lang-option" data-lang="de" onclick="selectLanguage('de')">Deutsch</button>
          <button class="lang-option" data-lang="fr" onclick="selectLanguage('fr')">Français</button>
        </div>
      </div>
    </header>

    <!-- 页面内容区 -->
    <main id="main-content">
      <!-- 首页 -->
      <section id="page-home" class="page active">
        <div class="welcome-section">
          <h1 class="welcome-title">
            <span class="wave">👋</span> <span data-i18n="app.welcome">欢迎小朋友!</span>
          </h1>
          <p class="welcome-subtitle" data-i18n="app.welcome.subtitle">今天想学什么呢?</p>
        </div>

        <!-- 最近使用 -->
        <div class="recent-used-section hidden" id="recent-used-section">
          <div class="section-header">
            <span class="section-icon">🕐</span>
            <span class="section-title" data-i18n="recent.title">最近使用</span>
          </div>
          <div class="recent-used-list" id="recent-used-list">
            <!-- 动态生成 -->
          </div>
        </div>

        <!-- 首页分类标签 -->
        <div class="home-category-tabs">
          <button class="home-tab active" data-category="all" onclick="filterHomeCards('all')">
            <span class="tab-emoji">🌟</span>
            <span data-i18n="home.tab.all">全部</span>
          </button>
          <button class="home-tab" data-category="learn" onclick="filterHomeCards('learn')">
            <span class="tab-emoji">📚</span>
            <span data-i18n="home.tab.learn">学习</span>
          </button>
          <button class="home-tab" data-category="play" onclick="filterHomeCards('play')">
            <span class="tab-emoji">🎮</span>
            <span data-i18n="home.tab.play">游戏</span>
          </button>
          <button class="home-tab" data-category="tools" onclick="filterHomeCards('tools')">
            <span class="tab-emoji">🔧</span>
            <span data-i18n="home.tab.tools">工具</span>
          </button>
        </div>

        <div class="menu-grid" id="home-menu-grid">
          <!-- 学习类 -->
          <div class="menu-card card-math" data-category="learn" onclick="navigateTo('math')">
            <div class="card-icon">🔢</div>
            <div class="card-title" data-i18n="menu.math">数学游戏</div>
            <div class="card-desc" data-i18n="menu.math.desc">加减法挑战</div>
          </div>

          <div class="menu-card card-english" data-category="learn" onclick="navigateTo('english')">
            <div class="card-icon">🔤</div>
            <div class="card-title" data-i18n="menu.english">学英语</div>
            <div class="card-desc" data-i18n="menu.english.desc">字母和单词</div>
          </div>

          <div class="menu-card card-chinese" data-category="learn" onclick="navigateTo('chinese')">
            <div class="card-icon">📝</div>
            <div class="card-title" data-i18n="menu.chinese">学中文</div>
            <div class="card-desc" data-i18n="menu.chinese.desc">认字和拼音</div>
          </div>

          <div class="menu-card card-science" data-category="learn" onclick="navigateTo('science')">
            <div class="card-icon">🔬</div>
            <div class="card-title" data-i18n="menu.science">科学探索</div>
            <div class="card-desc" data-i18n="menu.science.desc">发现神奇世界</div>
          </div>

          <!-- 游戏类 -->
          <div class="menu-card card-explore" data-category="play" onclick="navigateTo('explore')">
            <div class="card-icon">🎬</div>
            <div class="card-title" data-i18n="menu.explore">探索视频</div>
            <div class="card-desc" data-i18n="menu.explore.desc">看有趣的视频</div>
          </div>

          <div class="menu-card card-puzzle" data-category="play" onclick="navigateTo('puzzle')">
            <div class="card-icon">🧩</div>
            <div class="card-title" data-i18n="menu.puzzle">拼图游戏</div>
            <div class="card-desc" data-i18n="menu.puzzle.desc">锻炼观察力</div>
          </div>

          <!-- 工具类 -->
          <div class="menu-card card-timer" data-category="tools" onclick="navigateTo('timer')">
            <div class="card-icon">⏰</div>
            <div class="card-title" data-i18n="menu.timer">玩耍计时</div>
            <div class="card-desc" data-i18n="menu.timer.desc">设置倒计时</div>
          </div>

          <div class="menu-card card-calendar" data-category="tools" onclick="navigateTo('calendar')">
            <div class="card-icon">📅</div>
            <div class="card-title" data-i18n="menu.calendar">我的日历</div>
            <div class="card-desc" data-i18n="menu.calendar.desc">记录每一天</div>
          </div>

          <div class="menu-card card-sleep-music" data-category="tools" onclick="navigateTo('sleep-music')">
            <div class="card-icon">🎵</div>
            <div class="card-title" data-i18n="menu.sleepMusic">睡眠音乐</div>
            <div class="card-desc" data-i18n="menu.sleepMusic.desc">助眠好音乐</div>
          </div>

          <div class="menu-card card-profile" data-category="tools" onclick="navigateTo('profile')">
            <div class="card-icon">👤</div>
            <div class="card-title" data-i18n="menu.profile">我的信息</div>
            <div class="card-desc" data-i18n="menu.profile.desc">编辑个人资料</div>
          </div>

          <!-- P0新功能入口 -->
          <div class="menu-card card-checkin" data-category="tools" onclick="showCheckin()">
            <div class="card-icon">📅</div>
            <div class="card-title" data-i18n="menu.checkin">每日签到</div>
            <div class="card-desc" data-i18n="menu.checkin.desc">签到领奖励</div>
            <div id="checkin-preview" class="checkin-preview-mini"></div>
          </div>

          <div class="menu-card card-achievements" data-category="tools" onclick="showAchievements()">
            <div class="card-icon">🏆</div>
            <div class="card-title" data-i18n="menu.achievements">我的成就</div>
            <div class="card-desc" data-i18n="menu.achievements.desc">徽章收集</div>
          </div>

          <div class="menu-card card-wrong-questions" data-category="tools" onclick="showWrongQuestions()">
            <div class="card-icon">📕</div>
            <div class="card-title" data-i18n="menu.wrongQuestions">错题本</div>
            <div class="card-desc" data-i18n="menu.wrongQuestions.desc">复习巩固</div>
          </div>

          <!-- P1新功能入口 -->
          <div class="menu-card card-memory-game" data-category="play" onclick="showMemoryGame()">
            <div class="card-icon">🧠</div>
            <div class="card-title" data-i18n="menu.memory">记忆训练</div>
            <div class="card-desc" data-i18n="menu.memory.desc">锻炼记忆力</div>
          </div>

          <div class="menu-card card-learning-pet" data-category="play" onclick="showLearningPet()">
            <div class="card-icon">🐱</div>
            <div class="card-title" data-i18n="menu.pet">学习宠物</div>
            <div class="card-desc" data-i18n="menu.pet.desc">陪你一起学</div>
          </div>

          <div class="menu-card card-learning-report" data-category="tools" onclick="showLearningReport()">
            <div class="card-icon">📊</div>
            <div class="card-title" data-i18n="menu.report">学习报告</div>
            <div class="card-desc" data-i18n="menu.report.desc">查看进步</div>
          </div>

          <!-- P2新功能入口 -->
          <div class="menu-card card-picture-book" data-category="learn" onclick="showPictureBook()">
            <div class="card-icon">📚</div>
            <div class="card-title" data-i18n="menu.pictureBook">绘本故事</div>
            <div class="card-desc" data-i18n="menu.pictureBook.desc">听故事学知识</div>
          </div>

          <div class="menu-card card-pronunciation" data-category="learn" onclick="showPronunciation()">
            <div class="card-icon">🎤</div>
            <div class="card-title" data-i18n="menu.pronunciation">跟读练习</div>
            <div class="card-desc" data-i18n="menu.pronunciation.desc">练习发音</div>
          </div>

          <!-- 家长通知功能 -->
          <div class="menu-card card-parent-notify" data-category="tools" onclick="openMessageToParent()">
            <div class="card-icon">💬</div>
            <div class="card-title" data-i18n="menu.parentMessage">给爸妈留言</div>
            <div class="card-desc" data-i18n="menu.parentMessage.desc">发消息给家长</div>
          </div>

          <div class="menu-card card-sos" data-category="tools" onclick="triggerSOS()">
            <div class="card-icon">🆘</div>
            <div class="card-title" data-i18n="menu.sos">紧急求助</div>
            <div class="card-desc" data-i18n="menu.sos.desc">通知爸爸妈妈</div>
          </div>

          <div class="menu-card card-parent-settings" data-category="tools" onclick="openParentSettings()">
            <div class="card-icon">👨‍👩‍👧</div>
            <div class="card-title" data-i18n="menu.parentSettings">家长设置</div>
            <div class="card-desc" data-i18n="menu.parentSettings.desc">配置通知</div>
          </div>

          <!-- 创作功能 -->
          <div class="menu-card card-drawing" data-category="play" onclick="openDrawing()">
            <div class="card-icon">🎨</div>
            <div class="card-title" data-i18n="menu.drawing">画画创作</div>
            <div class="card-desc" data-i18n="menu.drawing.desc">自由绘画</div>
          </div>

          <div class="menu-card card-music" data-category="play" onclick="openMusic()">
            <div class="card-icon">🎵</div>
            <div class="card-title" data-i18n="menu.music">音乐创作</div>
            <div class="card-desc" data-i18n="menu.music.desc">弹琴打鼓</div>
          </div>

          <div class="menu-card card-writing" data-category="learn" onclick="openWriting()">
            <div class="card-icon">✍️</div>
            <div class="card-title" data-i18n="menu.writing">书写练习</div>
            <div class="card-desc" data-i18n="menu.writing.desc">汉字笔顺</div>
          </div>

          <div class="menu-card card-life-skills" data-category="learn" onclick="openLifeSkills()">
            <div class="card-icon">🏠</div>
            <div class="card-title" data-i18n="menu.lifeSkills">生活技能</div>
            <div class="card-desc" data-i18n="menu.lifeSkills.desc">时钟钱币日历</div>
          </div>

          <div class="menu-card card-song-practice" data-category="learn" onclick="openSongPractice()">
            <div class="card-icon">🎤</div>
            <div class="card-title" data-i18n="menu.songPractice">歌曲练习</div>
            <div class="card-desc" data-i18n="menu.songPractice.desc">跟唱新年歌</div>
          </div>

          <div class="menu-card card-family-pk" data-category="play" onclick="showFamilyPK()">
            <div class="card-icon">👨‍👩‍👧</div>
            <div class="card-title" data-i18n="menu.familyPK">亲子PK</div>
            <div class="card-desc" data-i18n="menu.familyPK.desc">家庭互动挑战</div>
          </div>

        </div>

        <div class="daily-progress">
          <h3 data-i18n="progress.title">今日进度</h3>
          <div class="progress-bar">
            <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
          </div>
          <p class="progress-text" id="progress-text">完成 <span id="tasks-done">0</span>/10 个任务解锁奖励视频!</p>
        </div>
      </section>

      <!-- 探索视频页 -->
      <section id="page-explore" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')" data-i18n="btn.back">← 返回</button>
          <h2>🎬 <span data-i18n="videos.title">探索视频</span></h2>
        </div>

        <!-- 分类标签 -->
        <div class="category-tabs" id="category-tabs">
          <button class="category-tab active" data-category="all" onclick="filterVideos('all')">
            <span class="tab-icon">📚</span>
            <span class="tab-name">全部</span>
          </button>
          <button class="category-tab" data-category="math" onclick="filterVideos('math')">
            <span class="tab-icon">🔢</span>
            <span class="tab-name">数学</span>
          </button>
          <button class="category-tab" data-category="english" onclick="filterVideos('english')">
            <span class="tab-icon">🔤</span>
            <span class="tab-name">英语</span>
          </button>
          <button class="category-tab" data-category="science" onclick="filterVideos('science')">
            <span class="tab-icon">🔬</span>
            <span class="tab-name">科普</span>
          </button>
          <button class="category-tab" data-category="emotion" onclick="filterVideos('emotion')">
            <span class="tab-icon">💝</span>
            <span class="tab-name">情绪</span>
          </button>
          <button class="category-tab" data-category="brain" onclick="filterVideos('brain')">
            <span class="tab-icon">🧠</span>
            <span class="tab-name">脑力</span>
          </button>
          <button class="category-tab" data-category="music" onclick="filterVideos('music')">
            <span class="tab-icon">🎵</span>
            <span class="tab-name">音乐</span>
          </button>
        </div>

        <!-- 当前分类描述 -->
        <div class="category-info" id="category-info">
          <p class="category-desc">精选30个适合6岁儿童的优质视频</p>
        </div>

        <!-- 视频网格 -->
        <div class="video-grid" id="video-grid">
          <!-- 默认加载状态 -->
          <div class="video-loading">
            <span class="loading-icon">🎬</span>
            <p>加载中...</p>
          </div>
        </div>
      </section>

      <!-- 视频详情弹窗 -->
      <div id="video-detail-modal" class="video-detail-modal hidden">
        <div class="video-detail-content">
          <button class="video-detail-close" onclick="closeVideoDetail()">✕</button>
          <div class="video-detail-header">
            <span class="video-detail-icon" id="detail-icon">🎬</span>
            <div class="video-detail-title-area">
              <h3 id="detail-title">视频标题</h3>
              <p id="detail-title-zh" class="detail-title-zh">中文标题</p>
            </div>
          </div>
          <div class="video-detail-meta">
            <span class="meta-tag" id="detail-duration">⏱️ 5:00</span>
            <span class="meta-tag" id="detail-channel">📺 频道</span>
            <span class="meta-tag" id="detail-age">👶 5-7岁</span>
          </div>
          <div class="video-detail-section">
            <h4>📖 简介</h4>
            <p id="detail-desc">视频描述</p>
          </div>
          <div class="video-detail-section">
            <h4>✅ 为什么推荐</h4>
            <p id="detail-why">推荐理由</p>
          </div>
          <div class="video-detail-section">
            <h4>🎯 技能培养</h4>
            <div class="skill-tags" id="detail-skills">
              <!-- 技能标签由 JS 生成 -->
            </div>
          </div>
          <div class="video-detail-section parent-tip">
            <h4>💡 家长贴士</h4>
            <p id="detail-parent-tip">给家长的建议</p>
          </div>
          <button class="btn-play-video" id="btn-play-detail" onclick="playVideoFromDetail()">
            ▶️ 播放视频
          </button>
        </div>
      </div>

      <!-- 数学游戏页 -->
      <section id="page-math" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')" data-i18n="btn.back">← 返回</button>
          <h2>🔢 <span data-i18n="math.title">数学游戏</span></h2>
        </div>

        <!-- 数学设置 -->
        <div class="math-settings">
          <div class="math-setting-row">
            <span class="setting-label" data-i18n="math.range">范围</span>
            <div class="math-range-buttons">
              <button class="math-range-btn active" data-range="10" onclick="setMathRange(10)" data-i18n="math.range10">10以内</button>
              <button class="math-range-btn" data-range="20" onclick="setMathRange(20)" data-i18n="math.range20">20以内</button>
              <button class="math-range-btn" data-range="30" onclick="setMathRange(30)" data-i18n="math.range30">30以内</button>
            </div>
          </div>
          <div class="math-setting-row">
            <span class="setting-label" data-i18n="math.operation">运算</span>
            <div class="math-op-buttons">
              <button class="math-op-btn active" data-op="+" onclick="toggleMathOperator('+')">➕ <span data-i18n="math.add">加</span></button>
              <button class="math-op-btn active" data-op="-" onclick="toggleMathOperator('-')">➖ <span data-i18n="math.subtract">减</span></button>
              <button class="math-op-btn" data-op="×" onclick="toggleMathOperator('×')">✖️ <span data-i18n="math.multiply">乘</span></button>
              <button class="math-op-btn" data-op="÷" onclick="toggleMathOperator('÷')">➗ <span data-i18n="math.divide">除</span></button>
            </div>
          </div>
        </div>

        <div class="game-area">
          <div class="math-question">
            <span id="num1">3</span>
            <span id="operator">+</span>
            <span id="num2">2</span>
            <span>=</span>
            <span class="answer-box">?</span>
          </div>
          <div class="answer-options" id="math-options">
            <!-- 动态生成选项 -->
          </div>
          <div class="math-stats">
            <span><span data-i18n="math.correct">正确</span>: <span id="math-correct">0</span></span>
            <span><span data-i18n="math.streak">连续答对</span>: <span id="math-streak">0</span> 🔥</span>
          </div>
        </div>
      </section>

      <!-- 英语学习页 -->
      <section id="page-english" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')" data-i18n="btn.back">← 返回</button>
          <h2>🔤 <span data-i18n="english.title">学英语</span></h2>
        </div>
        <div class="game-area">
          <div class="word-display">
            <div class="word-image" id="english-image">🍎</div>
            <div class="word-text" id="english-word">Apple</div>
            <button class="btn-sound" onclick="speakWord()">🔊 <span data-i18n="english.listen">听发音</span></button>
          </div>
          <p class="question-text" data-i18n="english.whatIsThis">这是什么?</p>
          <div class="answer-options" id="english-options">
            <!-- 动态生成选项 -->
          </div>
        </div>
      </section>

      <!-- 中文学习页 -->
      <section id="page-chinese" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')" data-i18n="btn.back">← 返回</button>
          <h2>📝 <span data-i18n="chinese.title">学中文</span></h2>
        </div>
        <div class="game-area">
          <div class="character-display">
            <div class="big-character" id="chinese-char">大</div>
            <div class="pinyin" id="chinese-pinyin">dà</div>
          </div>
          <p class="question-text" data-i18n="chinese.selectMeaning">选择正确的意思:</p>
          <div class="answer-options" id="chinese-options">
            <!-- 动态生成选项 -->
          </div>
        </div>
      </section>

      <!-- 科学探索页 -->
      <section id="page-science" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')" data-i18n="btn.back">← 返回</button>
          <h2>🔬 <span data-i18n="science.title">科学探索</span></h2>
        </div>

        <!-- 主题选择界面 -->
        <div class="science-themes" id="science-themes">
          <p class="science-intro" data-i18n="science.selectTheme">选择你想探索的主题 🎯</p>
          <div class="theme-list" id="theme-list">
            <!-- 动态生成主题卡片 -->
          </div>
        </div>

        <!-- 答题界面 -->
        <div class="science-quiz hidden" id="science-quiz">
          <!-- 进度指示 -->
          <div class="quiz-progress">
            <span class="quiz-progress-text">第 <span id="science-current">1</span>/<span id="science-total">10</span> 题</span>
            <div class="quiz-progress-bar">
              <div class="quiz-progress-fill" id="science-progress-fill"></div>
            </div>
          </div>

          <!-- 题目区域 -->
          <div class="quiz-question-area">
            <div class="quiz-image" id="science-image">🦁</div>
            <div class="quiz-question-box">
              <h3 class="quiz-question" id="science-question">这是什么动物？</h3>
              <p class="quiz-hint" id="science-hint">它被称为"森林之王"</p>
            </div>
          </div>

          <!-- 选项区域 -->
          <div class="quiz-options" id="science-options">
            <!-- 动态生成选项 -->
          </div>

          <!-- 返回主题按钮 -->
          <button class="btn-back-themes" onclick="backToThemes()">← 返回主题选择</button>
        </div>
      </section>

      <!-- 科学答题反馈弹窗 -->
      <div id="science-feedback-modal" class="science-feedback-modal hidden">
        <div class="science-feedback-content">
          <div class="feedback-icon" id="science-feedback-icon">⭐</div>
          <h2 class="feedback-title" id="science-feedback-title">答对啦！</h2>
          <div class="feedback-answer" id="science-feedback-answer">🦁 狮子</div>
          <div class="feedback-knowledge">
            <h4 id="science-knowledge-title">💡 你知道吗？</h4>
            <p id="science-knowledge-text">狮子是唯一群居的猫科动物哦！</p>
          </div>
          <div class="feedback-points" id="science-feedback-points">+15 积分 🎉</div>
          <button class="btn-continue-science" id="btn-continue-science" onclick="continueScience()">继续探索 →</button>
        </div>
      </div>

      <!-- 科学主题完成弹窗 -->
      <div id="science-complete-modal" class="science-complete-modal hidden">
        <div class="science-complete-content">
          <div class="complete-stars">🌟⭐🌟</div>
          <h2 class="complete-title">主题完成！</h2>
          <div class="complete-stats">
            <div class="complete-stat">
              <span class="stat-num" id="science-correct-count">8</span>
              <span class="stat-label">答对</span>
            </div>
            <div class="complete-stat">
              <span class="stat-num" id="science-total-count">10</span>
              <span class="stat-label">总题数</span>
            </div>
          </div>
          <div class="complete-bonus" id="science-bonus">+50 积分奖励！🎊</div>
          <button class="btn-back-themes-complete" onclick="backToThemesFromComplete()">选择其他主题</button>
        </div>
      </div>

      <!-- 倒计时页面 -->
      <section id="page-timer" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')" data-i18n="btn.back">← 返回</button>
          <h2>⏰ <span data-i18n="timer.title">玩耍倒计时</span></h2>
        </div>

        <div class="timer-container">
          <!-- 倒计时显示 -->
          <div class="timer-display" id="timer-display">
            <div class="timer-circle" id="timer-circle">
              <svg class="timer-svg" viewBox="0 0 200 200">
                <circle class="timer-bg" cx="100" cy="100" r="90"/>
                <circle class="timer-progress" id="timer-progress" cx="100" cy="100" r="90"/>
              </svg>
              <div class="timer-text">
                <span class="timer-minutes" id="timer-minutes">05</span>
                <span class="timer-colon">:</span>
                <span class="timer-seconds" id="timer-seconds">00</span>
              </div>
              <div class="timer-emoji" id="timer-emoji">🎮</div>
            </div>
          </div>

          <!-- 时间选择（未开始时显示） -->
          <div class="timer-setup" id="timer-setup">
            <p class="timer-hint" data-i18n="timer.selectTime">选择玩耍时间:</p>
            <div class="time-options">
              <button class="time-btn" onclick="setTimerMinutes(3)">
                <span class="time-num">3</span>
                <span class="time-unit" data-i18n="timer.minutes">分钟</span>
              </button>
              <button class="time-btn active" onclick="setTimerMinutes(5)">
                <span class="time-num">5</span>
                <span class="time-unit" data-i18n="timer.minutes">分钟</span>
              </button>
              <button class="time-btn" onclick="setTimerMinutes(10)">
                <span class="time-num">10</span>
                <span class="time-unit" data-i18n="timer.minutes">分钟</span>
              </button>
              <button class="time-btn" onclick="setTimerMinutes(15)">
                <span class="time-num">15</span>
                <span class="time-unit" data-i18n="timer.minutes">分钟</span>
              </button>
            </div>
            <button class="btn-start-timer" onclick="startTimer()">
              ▶️ <span data-i18n="timer.start">开始倒计时</span>
            </button>
          </div>

          <!-- 控制按钮（运行中显示） -->
          <div class="timer-controls hidden" id="timer-controls">
            <button class="timer-control-btn btn-pause" id="btn-pause" onclick="togglePauseTimer()">
              ⏸️ <span data-i18n="btn.pause">暂停</span>
            </button>
            <button class="timer-control-btn btn-stop" onclick="stopTimer()">
              ⏹️ <span data-i18n="timer.end">结束</span>
            </button>
          </div>

          <!-- 鼓励语 -->
          <div class="timer-message" id="timer-message">
            <p data-i18n="timer.encouragement">玩得开心！时间到了要乖乖走哦~ 🌟</p>
          </div>
        </div>
      </section>

      <!-- 时间到弹窗 -->
      <div id="timer-finish-modal" class="timer-finish-modal hidden">
        <div class="timer-finish-content">
          <div class="finish-emoji">⏰</div>
          <h2 class="finish-title" data-i18n="timer.timeUp">时间到啦!</h2>
          <p class="finish-message" data-i18n="timer.timeUpMessage">玩得开心吗？现在该回家咯~ 🏠</p>
          <div class="finish-animation">
            <span>🌈</span><span>⭐</span><span>🎉</span>
          </div>
          <button class="btn-finish-ok" onclick="closeTimerFinish()">
            好的，我知道了 👋
          </button>
        </div>
      </div>

      <!-- 个人信息页面 -->
      <section id="page-profile" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')" data-i18n="btn.back">← 返回</button>
          <h2>👤 <span data-i18n="profile.title">我的信息</span></h2>
        </div>

        <div class="profile-container">
          <!-- 头像区域 -->
          <div class="profile-avatar-section">
            <div class="avatar-wrapper" onclick="showPhotoOptions()">
              <img id="profile-avatar" class="profile-avatar" src="" alt="头像">
              <div class="avatar-placeholder" id="avatar-placeholder">
                <span>📷</span>
                <span class="avatar-hint" data-i18n="profile.avatar.add">点击添加照片</span>
              </div>
              <div class="avatar-edit-icon">📷</div>
            </div>
          </div>

          <!-- 个人信息表单 -->
          <div class="profile-form">
            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">👶</span>
                <span data-i18n="profile.name">我的名字</span>
              </label>
              <input type="text" id="profile-name" class="form-input" data-i18n-placeholder="profile.name.placeholder" placeholder="输入你的名字" maxlength="20">
            </div>

            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">🎂</span>
                <span data-i18n="profile.age">我的年龄</span>
              </label>
              <div class="age-selector">
                <button class="age-btn" onclick="changeAge(-1)">－</button>
                <span class="age-display" id="profile-age">6</span>
                <span class="age-unit" data-i18n="profile.age.unit">岁</span>
                <button class="age-btn" onclick="changeAge(1)">＋</button>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">🎈</span>
                <span data-i18n="profile.birthday">生日</span>
              </label>
              <input type="date" id="profile-birthday" class="form-input">
            </div>

            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">💖</span>
                <span data-i18n="profile.hobbies">我喜欢的事情</span>
              </label>
              <div class="hobbies-grid" id="hobbies-grid">
                <button class="hobby-tag" data-hobby="drawing" onclick="toggleHobby(this)">🎨 <span data-i18n="hobby.drawing">画画</span></button>
                <button class="hobby-tag" data-hobby="singing" onclick="toggleHobby(this)">🎤 <span data-i18n="hobby.singing">唱歌</span></button>
                <button class="hobby-tag" data-hobby="dancing" onclick="toggleHobby(this)">💃 <span data-i18n="hobby.dancing">跳舞</span></button>
                <button class="hobby-tag" data-hobby="sports" onclick="toggleHobby(this)">⚽ <span data-i18n="hobby.sports">运动</span></button>
                <button class="hobby-tag" data-hobby="reading" onclick="toggleHobby(this)">📚 <span data-i18n="hobby.reading">看书</span></button>
                <button class="hobby-tag" data-hobby="blocks" onclick="toggleHobby(this)">🧱 <span data-i18n="hobby.blocks">积木</span></button>
                <button class="hobby-tag" data-hobby="dinosaurs" onclick="toggleHobby(this)">🦖 <span data-i18n="hobby.dinosaurs">恐龙</span></button>
                <button class="hobby-tag" data-hobby="animals" onclick="toggleHobby(this)">🐱 <span data-i18n="hobby.animals">动物</span></button>
                <button class="hobby-tag" data-hobby="cars" onclick="toggleHobby(this)">🚗 <span data-i18n="hobby.cars">汽车</span></button>
                <button class="hobby-tag" data-hobby="princess" onclick="toggleHobby(this)">👸 <span data-i18n="hobby.princess">公主</span></button>
                <button class="hobby-tag" data-hobby="space" onclick="toggleHobby(this)">🚀 <span data-i18n="hobby.space">太空</span></button>
                <button class="hobby-tag" data-hobby="food" onclick="toggleHobby(this)">🍰 <span data-i18n="hobby.food">美食</span></button>
              </div>
            </div>

            <button class="btn-save-profile" onclick="saveProfile()">
              💾 <span data-i18n="profile.save">保存信息</span>
            </button>
          </div>

          <!-- 语言设置 -->
          <div class="language-settings">
            <h3 class="language-settings-title">
              <span class="label-icon">🌐</span>
              <span data-i18n="settings.language">语言</span>
            </h3>
            <div class="language-selector" id="language-selector">
              <!-- 语言按钮由 I18n.initLanguageSelector() 动态生成 -->
            </div>
          </div>

          <!-- 数据管理区域 -->
          <div class="data-management">
            <h3 class="data-management-title">📦 <span data-i18n="profile.data">数据管理</span></h3>
            <div class="data-btns">
              <button class="btn-export" onclick="exportData()">
                <span class="btn-icon">📤</span>
                <span data-i18n="profile.export">导出数据</span>
              </button>
              <button class="btn-import" onclick="triggerImport()">
                <span class="btn-icon">📥</span>
                <span data-i18n="profile.import">导入数据</span>
              </button>
              <button class="btn-refresh" onclick="forceRefresh()">
                <span class="btn-icon">🔄</span>
                <span data-i18n="profile.refresh">强制刷新</span>
              </button>
            </div>
            <p class="data-warning" data-i18n="profile.data.warning">⚠️ 导入数据会覆盖当前所有数据</p>
          </div>
        </div>
      </section>

      <!-- 照片选项弹窗 -->
      <div id="photo-options-modal" class="photo-options-modal hidden">
        <div class="photo-options-content">
          <h3 data-i18n="photo.options">选择照片来源</h3>
          <div class="photo-options-buttons">
            <button class="photo-option-btn" onclick="takePhoto()">
              <span class="option-icon">📸</span>
              <span data-i18n="photo.take">拍照</span>
            </button>
            <button class="photo-option-btn" onclick="choosePhoto()">
              <span class="option-icon">🖼️</span>
              <span data-i18n="photo.choose">从相册选择</span>
            </button>
          </div>
          <button class="photo-cancel-btn" onclick="closePhotoOptions()" data-i18n="btn.cancel">取消</button>
        </div>
      </div>

      <!-- 导入确认弹窗 -->
      <div id="import-confirm-modal" class="confirm-modal hidden">
        <div class="confirm-modal-content">
          <div class="confirm-icon">⚠️</div>
          <h3 class="confirm-title">确认导入</h3>
          <p class="confirm-message">导入数据将覆盖当前所有数据，此操作不可撤销。</p>
          <div class="confirm-btns">
            <button class="btn-confirm-cancel" onclick="closeImportConfirm()">取消</button>
            <button class="btn-confirm-ok" onclick="confirmImport()">确认导入</button>
          </div>
        </div>
      </div>

      <!-- 隐藏的文件输入 -->
      <input type="file" id="photo-input-camera" accept="image/*" capture="user" style="display:none" onchange="handlePhotoSelect(event)">
      <input type="file" id="photo-input-gallery" accept="image/*" style="display:none" onchange="handlePhotoSelect(event)">
      <input type="file" id="import-file-input" accept=".json" style="display:none" onchange="handleImportFile(event)">

      <!-- 日历页 -->
      <section id="page-calendar" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')" data-i18n="btn.back">← 返回</button>
          <h2>📅 <span data-i18n="calendar.title">我的日历</span></h2>
        </div>

        <!-- 月份切换 -->
        <div class="calendar-header">
          <button class="calendar-nav-btn" onclick="changeMonth(-1)">◀</button>
          <h3 id="calendar-month-title">2026年1月</h3>
          <button class="calendar-nav-btn" onclick="changeMonth(1)">▶</button>
        </div>

        <!-- 月度统计 -->
        <div class="calendar-stats">
          <div class="stat-item stat-class">
            <span class="stat-icon">📚</span>
            <span class="stat-value" id="stat-classes">0</span>
            <span class="stat-label">节课外班</span>
          </div>
          <div class="stat-item stat-play">
            <span class="stat-icon">🎡</span>
            <span class="stat-value" id="stat-outings">0</span>
            <span class="stat-label">次出去玩</span>
          </div>
          <div class="stat-item stat-holiday">
            <span class="stat-icon">🏖️</span>
            <span class="stat-value" id="stat-holidays">0</span>
            <span class="stat-label">天假期</span>
          </div>
        </div>

        <!-- 日历网格 -->
        <div class="calendar-container">
          <div class="calendar-weekdays">
            <span>日</span>
            <span>一</span>
            <span>二</span>
            <span>三</span>
            <span>四</span>
            <span>五</span>
            <span>六</span>
          </div>
          <div class="calendar-grid" id="calendar-grid">
            <!-- 日历日期由 JS 动态生成 -->
          </div>
        </div>

        <!-- 选中日期的事件列表 -->
        <div class="day-events" id="day-events">
          <div class="day-events-header">
            <h4 id="selected-date-title">今天</h4>
            <button class="btn-add-event" onclick="showAddEventModal()">+ 添加</button>
          </div>
          <div class="events-list" id="events-list">
            <p class="no-events">这一天还没有安排哦~</p>
          </div>
        </div>
      </section>

      <!-- 睡眠音乐页面 -->
      <section id="page-sleep-music" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')" data-i18n="btn.back">← 返回</button>
          <h2>🎵 <span data-i18n="sleep.title">睡眠音乐</span></h2>
        </div>

        <!-- 播放器区域 -->
        <div class="sleep-music-player">
          <div class="player-disc-container">
            <div class="player-disc" id="player-disc">
              <div class="disc-center">🎵</div>
            </div>
          </div>
          <div class="player-info">
            <h3 class="player-song-name" id="player-song-name" data-i18n="sleep.selectMusic">选择一首音乐</h3>
            <p class="player-song-duration" id="player-song-duration">--:--</p>
          </div>
          <div class="player-controls">
            <button class="player-btn btn-stop-music" onclick="stopSleepMusic()" id="btn-stop-music" disabled>
              <span>⏹</span>
            </button>
            <button class="player-btn btn-play-music" onclick="toggleSleepMusic()" id="btn-play-music" disabled>
              <span id="play-icon">▶</span>
            </button>
          </div>
          <!-- 定时器显示 -->
          <div class="sleep-timer-display" id="sleep-timer-display">
            <span class="timer-icon">⏰</span>
            <span class="timer-remaining" id="timer-remaining">--:--</span>
          </div>
        </div>

        <!-- 定时器选项 -->
        <div class="sleep-timer-section">
          <h4 class="section-title">⏰ <span data-i18n="sleep.autoStop">定时关闭</span></h4>
          <div class="sleep-timer-options">
            <button class="sleep-timer-btn" data-minutes="0" onclick="setSleepTimer(0)">
              <span class="timer-value" data-i18n="sleep.noLimit">不限</span>
            </button>
            <button class="sleep-timer-btn active" data-minutes="15" onclick="setSleepTimer(15)">
              <span class="timer-value">15</span>
              <span class="timer-unit" data-i18n="sleep.minutes">分钟</span>
            </button>
            <button class="sleep-timer-btn" data-minutes="30" onclick="setSleepTimer(30)">
              <span class="timer-value">30</span>
              <span class="timer-unit" data-i18n="sleep.minutes">分钟</span>
            </button>
            <button class="sleep-timer-btn" data-minutes="45" onclick="setSleepTimer(45)">
              <span class="timer-value">45</span>
              <span class="timer-unit" data-i18n="sleep.minutes">分钟</span>
            </button>
            <button class="sleep-timer-btn" data-minutes="60" onclick="setSleepTimer(60)">
              <span class="timer-value">60</span>
              <span class="timer-unit" data-i18n="sleep.minutes">分钟</span>
            </button>
          </div>
        </div>

        <!-- 音乐列表 -->
        <div class="sleep-music-list">
          <h4 class="section-title">🎶 <span data-i18n="sleep.chooseMusic">选择音乐</span></h4>
          <div class="music-cards" id="music-cards">
            <!-- 动态生成音乐卡片 -->
          </div>
        </div>
      </section>

      <!-- 拼图游戏页面 -->
      <section id="page-puzzle" class="page">
        <div class="page-header">
          <button class="btn-back" onclick="navigateTo('home')" data-i18n="btn.back">← 返回</button>
          <h2>🧩 <span data-i18n="puzzle.title">拼图游戏</span></h2>
        </div>

        <!-- 选择界面 -->
        <div class="puzzle-select" id="puzzle-select">
          <!-- 难度选择 -->
          <div class="puzzle-section">
            <h3 class="puzzle-section-title" data-i18n="puzzle.selectDifficulty">选择难度</h3>
            <div class="difficulty-selector" id="difficulty-selector">
              <!-- 动态生成难度选项 -->
            </div>
          </div>

          <!-- 主题选择 -->
          <div class="puzzle-section">
            <h3 class="puzzle-section-title" data-i18n="puzzle.selectTheme">选择主题</h3>
            <div class="theme-selector" id="puzzle-theme-selector">
              <!-- 动态生成主题选项 -->
            </div>
          </div>

          <!-- 图片选择 -->
          <div class="puzzle-section">
            <h3 class="puzzle-section-title" data-i18n="puzzle.selectImage">选择图片</h3>
            <div class="image-selector" id="puzzle-image-selector">
              <!-- 动态生成图片选项 -->
            </div>
          </div>
        </div>

        <!-- 游戏界面 -->
        <div class="puzzle-game hidden" id="puzzle-game">
          <!-- 游戏控制栏 -->
          <div class="puzzle-controls">
            <button class="puzzle-control-btn" onclick="showPuzzleHint()">
              <span>👁</span>
              <span data-i18n="puzzle.hint">提示</span>
            </button>
            <div class="puzzle-timer">
              <span>⏱</span>
              <span id="puzzle-time">00:00</span>
            </div>
            <button class="puzzle-control-btn" onclick="restartPuzzle()">
              <span>🔄</span>
              <span data-i18n="puzzle.restart">重开</span>
            </button>
          </div>

          <!-- 原图参考（小图） -->
          <div class="puzzle-reference">
            <div class="reference-image" id="puzzle-reference-image">🦁</div>
            <span class="reference-label" data-i18n="puzzle.reference">原图参考</span>
          </div>

          <!-- 拼图板 -->
          <div class="puzzle-board-container">
            <div class="puzzle-board" id="puzzle-board">
              <!-- 动态生成拼图槽位 -->
            </div>
          </div>

          <!-- 碎片区 -->
          <div class="puzzle-pieces-container">
            <p class="pieces-hint" data-i18n="puzzle.dragHint">拖动碎片到上方拼图板</p>
            <div class="puzzle-pieces" id="puzzle-pieces">
              <!-- 动态生成碎片 -->
            </div>
          </div>

          <!-- 返回选择按钮 -->
          <button class="btn-back-select" onclick="backToPuzzleSelect()" data-i18n="puzzle.backToSelect">← 返回选择</button>
        </div>
      </section>
    </main>

  <!-- ========== P0功能弹窗 ========== -->

  <!-- 成就列表弹窗 -->
  <div id="achievements-modal" class="achievements-modal hidden">
    <div class="achievements-modal-content">
      <button class="modal-close-btn" onclick="closeAchievements()">✕</button>
      <h2 class="achievements-modal-title">🏆 <span data-i18n="achievements.title">我的成就</span></h2>
      <div id="achievements-list" class="achievements-list">
        <!-- 动态生成 -->
      </div>
    </div>
  </div>

  <!-- 成就解锁弹窗 -->
  <div id="achievement-unlock-modal" class="achievement-unlock-modal hidden">
    <div class="achievement-unlock-content">
      <div class="unlock-celebration">🎉</div>
      <div class="unlock-title" data-i18n="achievements.unlocked">成就解锁!</div>
      <div class="unlock-icon" id="unlock-achievement-icon">🏆</div>
      <div class="unlock-name" id="unlock-achievement-name">成就名称</div>
      <div class="unlock-desc" id="unlock-achievement-desc">成就描述</div>
      <button class="btn-unlock-close" onclick="closeAchievementUnlock()" data-i18n="achievements.awesome">太棒了!</button>
    </div>
  </div>

  <!-- 错题本列表弹窗 -->
  <div id="wrong-questions-modal" class="wrong-questions-modal hidden">
    <div class="wrong-questions-modal-content">
      <button class="modal-close-btn" onclick="closeWrongQuestions()">✕</button>
      <h2 class="wq-modal-title">📕 <span data-i18n="wrongQuestions.title">错题本</span></h2>
      <div id="wrong-questions-list" class="wrong-questions-list">
        <!-- 动态生成 -->
      </div>
    </div>
  </div>

  <!-- 错题详情弹窗 -->
  <div id="wrong-question-detail-modal" class="wrong-question-detail-modal hidden">
    <div class="wqd-modal-content">
      <button class="modal-close-btn" onclick="closeWrongQuestionDetail()">✕</button>
      <div id="wrong-question-detail-content">
        <!-- 动态生成 -->
      </div>
    </div>
  </div>

  <!-- 复习题目弹窗 -->
  <div id="review-question-modal" class="review-question-modal hidden">
    <div class="review-modal-content">
      <button class="modal-close-btn" onclick="closeReviewQuestion()">✕</button>
      <div id="review-question-content">
        <!-- 动态生成 -->
      </div>
    </div>
  </div>

  <!-- 签到页面弹窗 -->
  <div id="checkin-modal" class="checkin-modal hidden">
    <div class="checkin-modal-content">
      <button class="modal-close-btn" onclick="closeCheckin()">✕</button>
      <h2 class="checkin-modal-title">📅 <span data-i18n="checkin.title">每日签到</span></h2>
      <div id="checkin-stats" class="checkin-stats">
        <!-- 动态生成 -->
      </div>
      <div id="checkin-calendar" class="checkin-calendar">
        <!-- 动态生成 -->
      </div>
    </div>
  </div>

  <!-- 签到提醒弹窗 -->
  <div id="checkin-reminder-modal" class="checkin-reminder-modal hidden">
    <div class="checkin-reminder-content">
      <div class="reminder-header">
        <span class="reminder-star">⭐</span>
        <span class="reminder-title" data-i18n="checkin.today">今日签到</span>
        <span class="reminder-star">⭐</span>
      </div>
      <div class="reminder-reward">
        <span class="reminder-icon" id="checkin-reward-icon">🌟</span>
        <span class="reminder-points" id="checkin-reward-points">+5分</span>
      </div>
      <div class="reminder-streak" id="checkin-streak-info" data-i18n="checkin.startJourney">开始你的签到之旅吧!</div>
      <div class="reminder-actions">
        <button class="btn-checkin-now" onclick="doCheckinFromReminder()" data-i18n="checkin.checkInNow">立即签到</button>
        <button class="btn-checkin-later" onclick="closeCheckinReminder()" data-i18n="checkin.later">稍后再说</button>
      </div>
    </div>
  </div>

  <!-- 签到成功弹窗 -->
  <div id="checkin-success-modal" class="checkin-success-modal hidden">
    <div class="checkin-success-content">
      <div class="success-icon" id="checkin-success-icon">🌟</div>
      <div class="success-title" data-i18n="checkin.success">签到成功!</div>
      <div class="success-points" id="checkin-success-points">+5分</div>
      <div class="success-streak" id="checkin-success-streak">连续签到 1 天</div>
      <div class="success-badge hidden" id="checkin-success-badge"></div>
      <button class="btn-success-close" onclick="closeCheckinSuccess()" data-i18n="checkin.keepGoing">继续加油!</button>
    </div>
  </div>

  <!-- ========== P1功能弹窗 ========== -->

  <!-- 记忆游戏选择弹窗 -->
  <div id="memory-game-modal" class="memory-game-modal hidden">
    <div class="memory-game-modal-content">
      <button class="modal-close-btn" onclick="closeMemoryGame()">✕</button>
      <h2 class="memory-game-title">🧠 <span data-i18n="memory.title">记忆训练</span></h2>
      <div id="memory-game-select" class="memory-game-select">
        <!-- 游戏类型选择 -->
      </div>
      <div id="memory-game-area" class="memory-game-area hidden">
        <!-- 游戏区域 -->
      </div>
    </div>
  </div>

  <!-- 记忆游戏结果弹窗 -->
  <div id="memory-result-modal" class="memory-result-modal hidden">
    <div class="memory-result-content">
      <div class="memory-result-icon" id="memory-result-icon">🎉</div>
      <div class="memory-result-title" id="memory-result-title">太棒了!</div>
      <div class="memory-result-stats" id="memory-result-stats">
        <!-- 游戏统计 -->
      </div>
      <div class="memory-result-points" id="memory-result-points">+20 积分</div>
      <div class="memory-result-actions">
        <button class="btn-memory-again" onclick="restartMemoryGame()" data-i18n="memory.playAgain">再玩一次</button>
        <button class="btn-memory-back" onclick="backToMemorySelect()" data-i18n="memory.backToSelect">返回选择</button>
      </div>
    </div>
  </div>

  <!-- 学习宠物弹窗 -->
  <div id="learning-pet-modal" class="learning-pet-modal hidden">
    <div class="learning-pet-modal-content">
      <button class="modal-close-btn" onclick="closeLearningPet()">✕</button>
      <h2 class="learning-pet-title">🐱 <span data-i18n="pet.title">我的学习宠物</span></h2>

      <!-- 宠物选择界面（首次使用） -->
      <div id="pet-select-area" class="pet-select-area hidden">
        <p class="pet-select-hint" data-i18n="pet.selectHint">选择你的学习伙伴:</p>
        <div id="pet-type-list" class="pet-type-list">
          <!-- 宠物类型选择 -->
        </div>
        <input type="text" id="pet-name-input" class="pet-name-input" data-i18n-placeholder="pet.namePlaceholder" placeholder="给宠物起个名字..." maxlength="10">
        <button class="btn-adopt-pet" onclick="adoptPet()" data-i18n="pet.adopt">领养宠物</button>
      </div>

      <!-- 宠物主界面 -->
      <div id="pet-main-area" class="pet-main-area hidden">
        <!-- 宠物展示 -->
        <div class="pet-display-area">
          <div class="pet-stage-badge" id="pet-stage-badge">蛋</div>
          <div class="pet-avatar" id="pet-avatar">🥚</div>
          <div class="pet-name" id="pet-display-name">小宠物</div>
        </div>

        <!-- 宠物状态条 -->
        <div class="pet-status-bars">
          <div class="pet-status-bar">
            <span class="status-label">💖 <span data-i18n="pet.happiness">幸福度</span></span>
            <div class="status-bar-bg">
              <div class="status-bar-fill happiness-fill" id="happiness-fill"></div>
            </div>
            <span class="status-value" id="happiness-value">100</span>
          </div>
          <div class="pet-status-bar">
            <span class="status-label">🍖 <span data-i18n="pet.fullness">饱食度</span></span>
            <div class="status-bar-bg">
              <div class="status-bar-fill hunger-fill" id="hunger-fill"></div>
            </div>
            <span class="status-value" id="hunger-value">100</span>
          </div>
          <div class="pet-status-bar">
            <span class="status-label">⭐ <span data-i18n="pet.experience">经验值</span></span>
            <div class="status-bar-bg">
              <div class="status-bar-fill exp-fill" id="exp-fill"></div>
            </div>
            <span class="status-value" id="exp-value">0/100</span>
          </div>
        </div>

        <!-- 宠物操作按钮 -->
        <div class="pet-actions">
          <button class="pet-action-btn" onclick="showPetFeed()">
            <span class="action-icon">🍖</span>
            <span data-i18n="pet.feed">喂食</span>
          </button>
          <button class="pet-action-btn" onclick="showPetGames()">
            <span class="action-icon">🎮</span>
            <span data-i18n="petGame.title">游戏</span>
          </button>
          <button class="pet-action-btn" onclick="showPetRoom()">
            <span class="action-icon">🏡</span>
            <span data-i18n="pet.room.title">房间</span>
          </button>
          <button class="pet-action-btn" onclick="showPetOutfit()">
            <span class="action-icon">👗</span>
            <span data-i18n="pet.outfit.title">换装</span>
          </button>
        </div>

        <!-- 宠物消息 -->
        <div class="pet-message" id="pet-message">
          <span class="message-text">今天也要好好学习哦！</span>
        </div>
      </div>
    </div>
  </div>

  <!-- 喂食菜单弹窗 -->
  <div id="pet-feed-modal" class="pet-feed-modal hidden">
    <div class="pet-feed-content">
      <button class="modal-close-btn" onclick="closePetFeed()">✕</button>
      <h3>🍖 <span data-i18n="pet.feed">喂食</span></h3>
      <div id="food-list" class="food-list">
        <!-- 食物列表 -->
      </div>
    </div>
  </div>

  <!-- 装扮菜单弹窗 -->
  <div id="pet-accessories-modal" class="pet-accessories-modal hidden">
    <div class="pet-accessories-content">
      <button class="modal-close-btn" onclick="closePetAccessories()">✕</button>
      <h3>🎀 <span data-i18n="pet.dress">装扮</span></h3>
      <div id="accessories-list" class="accessories-list">
        <!-- 配饰列表 -->
      </div>
    </div>
  </div>

  <!-- 宠物进化弹窗 -->
  <div id="pet-evolution-modal" class="pet-evolution-modal hidden">
    <div class="pet-evolution-content">
      <div class="evolution-celebration">✨</div>
      <div class="evolution-title" data-i18n="pet.evolved">宠物进化了!</div>
      <div class="evolution-stages">
        <span class="old-stage" id="old-pet-stage">🥚</span>
        <span class="evolution-arrow">→</span>
        <span class="new-stage" id="new-pet-stage">🐱</span>
      </div>
      <div class="evolution-name" id="evolution-stage-name">幼年期</div>
      <button class="btn-evolution-close" onclick="closePetEvolution()" data-i18n="feedback.awesome">太棒了!</button>
    </div>
  </div>

  <!-- 宠物迷你游戏选择弹窗 -->
  <div id="pet-games-modal" class="pet-games-modal hidden">
    <div class="pet-games-content">
      <button class="modal-close-btn" onclick="closePetGames()">✕</button>
      <h3>🎮 <span data-i18n="petGame.title">宠物游戏</span></h3>
      <div id="pet-games-list" class="pet-games-list">
        <!-- 游戏列表动态生成 -->
      </div>
    </div>
  </div>

  <!-- 宠物游戏进行弹窗 -->
  <div id="pet-game-play-modal" class="pet-game-play-modal hidden">
    <div class="pet-game-play-content">
      <button class="modal-close-btn" onclick="closePetGamePlay()">✕</button>
      <div class="pet-game-header">
        <span class="pet-game-title" id="pet-game-title">🎮 游戏</span>
        <div class="pet-game-stats">
          <span id="pet-game-lives">❤️❤️❤️</span>
          <span id="pet-game-time">60s</span>
          <span>⭐ <span id="pet-game-score">0</span></span>
        </div>
      </div>
      <div class="pet-game-canvas-container">
        <canvas id="pet-game-canvas"></canvas>
      </div>
      <p class="pet-game-hint" data-i18n="petGame.hint">滑动或移动鼠标控制宠物</p>
    </div>
  </div>

  <!-- 宠物游戏结果弹窗 -->
  <div id="pet-game-result-modal" class="pet-game-result-modal hidden">
    <div class="pet-game-result-content">
      <div class="game-result-title" data-i18n="petGame.complete">游戏结束!</div>
      <div class="game-result-score">
        <span data-i18n="petGame.score">得分</span>: <span id="pet-game-final-score">0</span>
      </div>
      <div class="game-result-high" id="pet-game-high-score">最高分: 0</div>
      <div class="game-result-rewards">
        <div class="reward-item">
          <span>🐾</span>
          <span id="pet-game-exp-reward">+0 EXP</span>
        </div>
        <div class="reward-item">
          <span>⭐</span>
          <span id="pet-game-points-reward">+0</span>
        </div>
      </div>
      <div class="game-result-actions">
        <button class="btn-game-again" onclick="restartPetGame()" data-i18n="petGame.playAgain">再玩一次</button>
        <button class="btn-game-back" onclick="backToPetGameSelect()" data-i18n="petGame.backToSelect">返回选择</button>
      </div>
    </div>
  </div>

  <!-- 宠物换装弹窗 -->
  <div id="pet-outfit-modal" class="pet-outfit-modal hidden">
    <div class="pet-outfit-content">
      <button class="modal-close-btn" onclick="closePetOutfit()">✕</button>
      <h3>👗 <span data-i18n="pet.outfit.title">宠物换装</span></h3>
      <div class="outfit-preview-container">
        <div id="outfit-preview" class="outfit-preview">
          <!-- 预览动态生成 -->
        </div>
      </div>
      <div id="outfit-tabs" class="outfit-tabs">
        <!-- 标签动态生成 -->
      </div>
      <div id="outfit-items" class="outfit-items">
        <!-- 物品动态生成 -->
      </div>
    </div>
  </div>

  <!-- 宠物房间装饰弹窗 -->
  <div id="pet-room-modal" class="pet-room-modal hidden">
    <div class="pet-room-content">
      <button class="modal-close-btn" onclick="closePetRoom()">✕</button>
      <h3>🏡 <span data-i18n="pet.room.title">宠物房间</span></h3>
      <div class="room-preview-container">
        <div id="room-preview" class="room-preview">
          <!-- 房间预览动态生成 -->
        </div>
      </div>
      <div id="room-tabs" class="room-tabs">
        <!-- 标签动态生成 -->
      </div>
      <div id="room-items" class="room-items">
        <!-- 物品动态生成 -->
      </div>
    </div>
  </div>

  <!-- 学习报告弹窗 -->
  <div id="learning-report-modal" class="learning-report-modal hidden">
    <div class="learning-report-modal-content">
      <button class="modal-close-btn" onclick="closeLearningReport()">✕</button>

      <!-- 报告周期选择 -->
      <div class="report-period-selector">
        <button class="report-period-btn active" data-period="week" onclick="changeReportPeriod('week')" data-i18n="report.week">本周</button>
        <button class="report-period-btn" data-period="month" onclick="changeReportPeriod('month')" data-i18n="report.month">本月</button>
        <button class="report-period-btn" data-period="all" onclick="changeReportPeriod('all')" data-i18n="report.all">全部</button>
      </div>

      <!-- 报告内容 -->
      <div id="learning-report-content" class="learning-report-content">
        <!-- 动态生成 -->
      </div>

      <!-- 分享按钮 -->
      <button class="btn-share-report" onclick="shareReport()">📤 <span data-i18n="report.share">分享报告</span></button>
    </div>
  </div>

  <!-- P2: 绘本阅读弹窗 -->
  <div id="picture-book-modal" class="picture-book-modal hidden">
    <div class="picture-book-content">
      <button class="modal-close-btn" onclick="closePictureBook()">✕</button>

      <!-- 书架选择区域 -->
      <div id="book-select-area" class="book-select-area">
        <div class="bookshelf-header">
          <h2>📚 <span data-i18n="pictureBook.title">绘本故事</span></h2>
          <div class="bookshelf-tabs" id="bookshelf-tabs">
            <!-- 动态生成分类标签 -->
          </div>
        </div>
        <div id="bookshelf-grid" class="bookshelf-grid">
          <!-- 动态生成书籍 -->
        </div>
      </div>

      <!-- 阅读区域 -->
      <div id="book-read-area" class="book-read-area hidden">
        <div class="book-reader-header">
          <button class="btn-back-shelf" onclick="backToBookshelf()" data-i18n="pictureBook.backToShelf">← 返回书架</button>
          <h3 id="current-book-title">故事标题</h3>
          <button class="btn-toggle-auto" id="btn-auto-read" onclick="toggleAutoRead()">🔊 <span data-i18n="pictureBook.autoRead">自动朗读</span></button>
        </div>

        <div class="book-page-container">
          <div class="book-page" id="book-page">
            <div class="page-illustration" id="page-illustration">📖</div>
            <div class="page-text" id="page-text">故事内容...</div>
          </div>
        </div>

        <div class="book-controls">
          <button class="btn-page-nav" id="btn-prev-page" onclick="prevBookPage()">◀ <span data-i18n="pictureBook.prevPage">上一页</span></button>
          <span class="page-indicator" id="page-indicator">1 / 5</span>
          <button class="btn-page-nav" id="btn-next-page" onclick="nextBookPage()"><span data-i18n="pictureBook.nextPage">下一页</span> ▶</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 绘本完成弹窗 -->
  <div id="book-complete-modal" class="book-complete-modal hidden">
    <div class="book-complete-content">
      <div class="complete-celebration">🎉</div>
      <div class="complete-title" data-i18n="pictureBook.finished">读完啦！</div>
      <div class="complete-book-name" id="completed-book-name">三只小猪</div>
      <div class="complete-message" data-i18n="pictureBook.completeMessage">你真棒！又读完一本故事书！</div>
      <div class="complete-reward">
        <span class="reward-icon">⭐</span>
        <span class="reward-text">+10 积分</span>
      </div>
      <div class="complete-actions">
        <button class="btn-read-again" onclick="readBookAgain()" data-i18n="pictureBook.readAgain">再读一遍</button>
        <button class="btn-back-books" onclick="closeBookComplete()" data-i18n="pictureBook.backToShelf">返回书架</button>
      </div>
    </div>
  </div>

  <!-- P2: 跟读练习弹窗 -->
  <div id="pronunciation-modal" class="pronunciation-modal hidden">
    <div class="pronunciation-content">
      <button class="modal-close-btn" onclick="closePronunciation()">✕</button>

      <!-- 练习类型选择 -->
      <div id="pronunciation-select-area" class="pronunciation-select-area">
        <h2>🎤 <span data-i18n="pronunciation.title">跟读练习</span></h2>
        <div class="pronunciation-types" id="pronunciation-types">
          <!-- 动态生成练习类型 -->
        </div>
        <div class="pronunciation-stats" id="pronunciation-stats">
          <!-- 练习统计 -->
        </div>
      </div>

      <!-- 练习区域 -->
      <div id="pronunciation-practice-area" class="pronunciation-practice-area hidden">
        <div class="practice-header">
          <button class="btn-back-select" onclick="backToPronunciationSelect()" data-i18n="btn.back">← 返回</button>
          <h3 id="practice-type-title">拼音练习</h3>
          <span class="practice-progress" id="practice-progress">1 / 10</span>
        </div>

        <div class="practice-main">
          <div class="practice-target">
            <div class="target-text" id="target-text">妈妈</div>
            <div class="target-pinyin" id="target-pinyin">mā ma</div>
          </div>

          <div class="practice-demo">
            <button class="btn-demo-play" id="btn-demo-play" onclick="playDemonstration()">
              🔊 <span data-i18n="pronunciation.listen">听示范</span>
            </button>
          </div>

          <div class="practice-record">
            <button class="btn-record" id="btn-record" onclick="toggleRecording()">
              <span class="record-icon">🎙️</span>
              <span class="record-text" data-i18n="pronunciation.record">点击录音</span>
            </button>
            <div class="record-status" id="record-status" data-i18n="pronunciation.ready">准备好了</div>
          </div>

          <div class="practice-result hidden" id="practice-result">
            <div class="result-score" id="result-score">90</div>
            <div class="result-label">分</div>
            <div class="result-feedback" id="result-feedback">非常棒！</div>
            <div class="result-recognized" id="result-recognized">识别结果: 妈妈</div>
          </div>
        </div>

        <div class="practice-actions">
          <button class="btn-try-again" id="btn-try-again" onclick="tryAgain()" data-i18n="btn.retry">再试一次</button>
          <button class="btn-next-item" id="btn-next-item" onclick="nextPracticeItem()"><span data-i18n="btn.next">下一个</span> ▶</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 跟读完成弹窗 -->
  <div id="pronunciation-complete-modal" class="pronunciation-complete-modal hidden">
    <div class="pronunciation-complete-content">
      <div class="complete-celebration">🎉</div>
      <div class="complete-title" data-i18n="pronunciation.complete">练习完成!</div>
      <div class="complete-summary">
        <div class="summary-item">
          <span class="summary-label" data-i18n="pronunciation.practiceCount">练习数量</span>
          <span class="summary-value" id="summary-count">10</span>
        </div>
        <div class="summary-item">
          <span class="summary-label" data-i18n="pronunciation.avgScore">平均得分</span>
          <span class="summary-value" id="summary-avg-score">85</span>
        </div>
        <div class="summary-item">
          <span class="summary-label" data-i18n="pronunciation.maxScore">最高得分</span>
          <span class="summary-value" id="summary-max-score">95</span>
        </div>
      </div>
      <div class="complete-reward">
        <span class="reward-icon">⭐</span>
        <span class="reward-text" id="pronunciation-reward">+15 积分</span>
      </div>
      <button class="btn-pronunciation-done" onclick="closePronunciationComplete()" data-i18n="feedback.awesome">太棒了!</button>
    </div>
  </div>


    <!-- 底部导航 -->
    <nav class="bottom-nav">
      <div class="nav-item active" onclick="navigateTo('home')">
        <span class="nav-icon">🏠</span>
        <span class="nav-label" data-i18n="nav.home">首页</span>
      </div>
      <div class="nav-item" onclick="navigateTo('home'); filterHomeCards('learn')">
        <span class="nav-icon">📚</span>
        <span class="nav-label" data-i18n="nav.learn">学习</span>
      </div>
      <div class="nav-item" onclick="navigateTo('home'); filterHomeCards('play')">
        <span class="nav-icon">🎮</span>
        <span class="nav-label" data-i18n="nav.play">游戏</span>
      </div>
      <div class="nav-item" onclick="navigateTo('home'); filterHomeCards('tools')">
        <span class="nav-icon">🔧</span>
        <span class="nav-label" data-i18n="nav.tools">工具</span>
      </div>
      <div class="nav-item" onclick="navigateTo('profile')">
        <span class="nav-icon">👤</span>
        <span class="nav-label" data-i18n="nav.profile">我的</span>
      </div>
    </nav>
  </div>

  <!-- AI聊天入口按钮（悬浮） -->
  <button id="ai-chat-fab" class="ai-chat-fab" onclick="openAIChat()">
    <span class="fab-icon">🤖</span>
    <span class="fab-text" data-i18n="ai.assistant">小助手</span>
  </button>

  <!-- AI聊天弹窗 -->
  <div id="ai-chat-modal" class="ai-chat-modal hidden">
    <div class="ai-chat-container">
      <!-- 头部 -->
      <div class="ai-chat-header">
        <div class="ai-chat-title">
          <span>🤖</span>
          <span data-i18n="ai.title">学习小助手</span>
        </div>
        <div class="ai-chat-actions">
          <button onclick="clearAIChat()" data-i18n-title="ai.clearChat" title="清空聊天">🗑️</button>
          <button onclick="closeAIChat()">✕</button>
        </div>
      </div>

      <!-- 下载确认界面 -->
      <div id="ai-chat-download-prompt" class="ai-chat-state hidden">
        <div class="download-prompt-content">
          <span class="prompt-icon">🤖</span>
          <h3 data-i18n="ai.enableAssistant">启用AI小助手</h3>
          <p data-i18n="ai.downloadSize">需要下载约 <strong>300MB</strong> 的数据</p>
          <p class="prompt-note" data-i18n="ai.offlineNote">下载后可以离线使用哦~</p>
          <div class="download-buttons">
            <button class="btn-download-start" onclick="startAIModelDownload()" data-i18n="ai.startDownload">
              开始下载
            </button>
            <button class="btn-download-cancel" onclick="closeAIChat()" data-i18n="ai.later">
              以后再说
            </button>
          </div>
        </div>
      </div>

      <!-- 加载中界面 -->
      <div id="ai-chat-loading" class="ai-chat-state hidden">
        <div class="loading-content">
          <span class="loading-icon">🤖</span>
          <h3 data-i18n="ai.preparing">小助手正在准备中...</h3>
          <div class="loading-bar">
            <div class="loading-bar-fill" id="ai-loading-bar-fill"></div>
          </div>
          <p class="loading-percent"><span id="ai-loading-percent">0</span>%</p>
          <div class="loading-fun-fact" id="ai-loading-fact">
            💡 小知识：大象是陆地上最大的动物哦！
          </div>
        </div>
      </div>

      <!-- 主聊天界面 -->
      <div id="ai-chat-main" class="ai-chat-main hidden">
        <!-- 消息区域 -->
        <div class="ai-chat-messages" id="ai-chat-messages">
          <div class="chat-welcome">
            <span class="welcome-emoji">🤖</span>
            <p data-i18n="ai.welcome1">你好呀！我是学习小助手~</p>
            <p data-i18n="ai.welcome2">有什么想问我的吗？</p>
          </div>
        </div>

        <!-- 预设问题 -->
        <div class="ai-preset-questions">
          <button onclick="usePresetQuestion('给我讲个小故事')">📖 <span data-i18n="ai.preset.story">讲故事</span></button>
          <button onclick="usePresetQuestion('为什么天是蓝色的')">🌤️ <span data-i18n="ai.preset.why">为什么</span></button>
          <button onclick="usePresetQuestion('1+1等于多少')">🔢 <span data-i18n="ai.preset.math">数学题</span></button>
          <button onclick="usePresetQuestion('苹果用英语怎么说')">🍎 <span data-i18n="ai.preset.english">学英语</span></button>
        </div>

        <!-- 语音模式开关 -->
        <div class="ai-voice-toggle">
          <label class="voice-switch">
            <input type="checkbox" id="ai-auto-speak" checked>
            <span class="voice-slider"></span>
          </label>
          <span data-i18n="ai.autoRead">自动朗读回复</span>
        </div>

        <!-- 输入区域 -->
        <div class="ai-chat-input-area">
          <button class="btn-voice" id="ai-voice-btn" onclick="toggleVoiceInput()">
            🎤
          </button>
          <input
            type="text"
            id="ai-chat-input"
            data-i18n-placeholder="ai.inputPlaceholder"
            placeholder="输入或点击麦克风说话..."
            onkeypress="if(event.key==='Enter')sendAIMessage()"
          >
          <button class="btn-send" onclick="sendAIMessage()">
            <span data-i18n="ai.send">发送</span> ✨
          </button>
        </div>

        <!-- 语音状态提示 -->
        <div id="ai-voice-status" class="ai-voice-status hidden">
          <span class="voice-wave">🎙️</span>
          <span id="ai-voice-text" data-i18n="ai.listening">正在听你说话...</span>
        </div>
      </div>

      <!-- 错误/不支持界面 -->
      <div id="ai-chat-error" class="ai-chat-state hidden">
        <div class="error-content">
          <span class="error-icon">😢</span>
          <p id="ai-error-message" data-i18n="ai.notSupported">暂不支持</p>
          <button onclick="closeAIChat()" data-i18n="ai.gotIt">知道了</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 睡眠音乐播放器 -->
  <audio id="sleep-audio" preload="auto" playsinline loop>
    <source id="sleep-audio-source" src="" type="audio/mpeg">
  </audio>

  <!-- ========== 家长通知系统 ========== -->

  <!-- 家长设置弹窗 -->
  <div id="parent-settings-modal" class="modal-overlay hidden">
    <div class="parent-settings-content">
      <div class="modal-header">
        <h2>👨‍👩‍👧 <span data-i18n="parent.settings">家长设置</span></h2>
        <button class="btn-close" onclick="closeParentSettings()">✕</button>
      </div>

      <div class="settings-body">
        <!-- Bark URL 设置 -->
        <div class="setting-section">
          <h3>📱 <span data-i18n="parent.barkSettings">Bark 推送设置</span></h3>
          <p class="setting-desc">
            1. 在 iPhone 上安装 <strong>Bark</strong> App<br>
            2. 打开 Bark，复制推送 URL<br>
            3. 分别粘贴到爸爸和妈妈的输入框
          </p>

          <!-- 爸爸的 Bark -->
          <div class="bark-input-group">
            <label>👨 爸爸的 Bark URL</label>
            <div class="bark-input-row">
              <input
                type="text"
                id="bark-url-dad"
                placeholder="https://api.day.app/xxxxxx/"
              >
              <button onclick="saveBarkUrl('dad')">测试</button>
            </div>
            <div id="bark-status-dad" class="bark-status hidden"></div>
          </div>

          <!-- 妈妈的 Bark -->
          <div class="bark-input-group">
            <label>👩 妈妈的 Bark URL</label>
            <div class="bark-input-row">
              <input
                type="text"
                id="bark-url-mom"
                placeholder="https://api.day.app/xxxxxx/"
              >
              <button onclick="saveBarkUrl('mom')">测试</button>
            </div>
            <div id="bark-status-mom" class="bark-status hidden"></div>
          </div>
        </div>

        <!-- 通知选项 -->
        <div class="setting-section">
          <h3>🔔 <span data-i18n="parent.notifyOptions">通知选项</span></h3>

          <label class="setting-item">
            <span data-i18n="parent.notifyAchievement">成就通知</span>
            <input type="checkbox" id="notify-achievement" checked
                   onchange="updateNotifySetting('notifyAchievement', this.checked)">
          </label>

          <label class="setting-item">
            <span data-i18n="parent.notifyProgress">学习进度通知</span>
            <input type="checkbox" id="notify-progress" checked
                   onchange="updateNotifySetting('notifyProgress', this.checked)">
          </label>

          <label class="setting-item">
            <span data-i18n="parent.notifyMessage">消息通知</span>
            <input type="checkbox" id="notify-message" checked
                   onchange="updateNotifySetting('notifyMessage', this.checked)">
          </label>

          <label class="setting-item">
            <span data-i18n="parent.notifyThreshold">每答几题通知</span>
            <select id="progress-threshold"
                    onchange="updateNotifySetting('progressThreshold', parseInt(this.value))">
              <option value="5">5题</option>
              <option value="10" selected>10题</option>
              <option value="20">20题</option>
              <option value="50">50题</option>
            </select>
          </label>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-primary" onclick="closeParentSettings()" data-i18n="btn.finish">完成</button>
      </div>
    </div>
  </div>

  <!-- 发消息给家长弹窗 -->
  <div id="message-parent-modal" class="modal-overlay hidden">
    <div class="message-parent-content">
      <div class="modal-header">
        <h2>💬 <span data-i18n="parent.message">给爸爸妈妈发消息</span></h2>
        <button class="btn-close" onclick="closeMessageToParent()">✕</button>
      </div>

      <div class="message-body">
        <!-- 预设消息 -->
        <div class="preset-messages">
          <button onclick="usePresetMessage('我想你们了~')">🥰 <span data-i18n="parent.preset.miss">想你们了</span></button>
          <button onclick="usePresetMessage('我饿了，想吃东西')">🍔 <span data-i18n="parent.preset.hungry">我饿了</span></button>
          <button onclick="usePresetMessage('我完成学习任务啦！')">✅ <span data-i18n="parent.preset.done">完成任务</span></button>
          <button onclick="usePresetMessage('我有问题想问你们')">❓ <span data-i18n="parent.preset.question">有问题</span></button>
        </div>

        <!-- 输入区域 -->
        <div class="message-input-area">
          <button class="btn-voice" id="msg-voice-btn" onclick="toggleMessageVoice()">
            🎤
          </button>
          <input
            type="text"
            id="parent-message-input"
            data-i18n-placeholder="parent.inputPlaceholder"
            placeholder="输入或说出你想说的话..."
          >
        </div>

        <button id="send-parent-msg-btn" class="btn-send-message" onclick="sendMessageToParent()">
          <span data-i18n="parent.message.send">发送给爸爸妈妈</span> 💌
        </button>
      </div>
    </div>
  </div>

  <!-- ========== 画画创作 ========== -->
  <div id="drawing-modal" class="drawing-modal hidden">
    <div class="drawing-container">
      <!-- 顶部工具栏 -->
      <div class="drawing-header">
        <button class="btn-back" onclick="closeDrawing()" data-i18n="btn.back">← 返回</button>
        <h2>🎨 <span data-i18n="drawing.title">画画创作</span></h2>
        <div class="header-buttons">
          <button class="btn-template" onclick="showTemplatePanel()" title="涂色模板">📋</button>
          <button class="btn-sticker" onclick="showStickerPanel()" title="贴纸印章">🏷️</button>
          <button id="symmetry-btn" class="btn-symmetry" onclick="toggleSymmetry()" title="对称模式">⬜</button>
          <button id="dark-mode-btn" class="btn-dark-mode" onclick="toggleDrawingDarkMode()" title="切换背景">☀️</button>
          <button class="btn-save" onclick="saveDrawing()">💾</button>
        </div>
      </div>

      <!-- 涂色模板面板 -->
      <div id="template-panel" class="template-panel hidden">
        <div class="template-header">
          <span>🎨 <span data-i18n="drawing.template">选择涂色模板</span></span>
          <button onclick="showTemplatePanel()">✕</button>
        </div>
        <div class="template-grid"></div>
      </div>

      <!-- 贴纸印章面板 -->
      <div id="sticker-panel" class="sticker-panel hidden">
        <div class="sticker-header">
          <span>🏷️ <span data-i18n="drawing.stickers">选择贴纸印章</span></span>
          <button onclick="hideStickerPanel()">✕</button>
        </div>
        <div class="sticker-content"></div>
      </div>

      <!-- 画布区域 -->
      <div class="drawing-canvas-container">
        <canvas id="drawing-canvas"></canvas>
      </div>

      <!-- 底部工具栏 -->
      <div class="drawing-toolbar">
        <!-- 基础画笔 -->
        <div class="toolbar-section">
          <div class="toolbar-label" data-i18n="drawing.tools.basic">基础</div>
          <div class="tool-buttons">
            <button class="drawing-tool-btn active" data-tool="pencil" onclick="setDrawingTool('pencil')" title="铅笔">✏️</button>
            <button class="drawing-tool-btn" data-tool="marker" onclick="setDrawingTool('marker')" title="马克笔">🖊️</button>
            <button class="drawing-tool-btn" data-tool="crayon" onclick="setDrawingTool('crayon')" title="蜡笔">🖍️</button>
            <button class="drawing-tool-btn" data-tool="eraser" onclick="setDrawingTool('eraser')" title="橡皮擦">🧽</button>
            <button class="drawing-tool-btn" data-tool="fill" onclick="setDrawingTool('fill')" title="填充">🪣</button>
            <button class="drawing-tool-btn" data-tool="sticker" onclick="showStickerPanel()" title="贴纸">🏷️</button>
          </div>
        </div>

        <!-- 魔法画笔 -->
        <div class="toolbar-section magic-section">
          <div class="toolbar-label">✨<span data-i18n="drawing.tools.magic">魔法</span></div>
          <div class="tool-buttons">
            <button class="drawing-tool-btn magic-btn" data-tool="neon" onclick="setDrawingTool('neon')" title="霓虹发光">💡</button>
            <button class="drawing-tool-btn magic-btn" data-tool="rainbow" onclick="setDrawingTool('rainbow')" title="彩虹">🌈</button>
            <button class="drawing-tool-btn magic-btn" data-tool="sparkle" onclick="setDrawingTool('sparkle')" title="闪光星星">✨</button>
          </div>
        </div>

        <!-- 对称模式 -->
        <div class="toolbar-section symmetry-section">
          <div class="toolbar-label">🪞<span data-i18n="drawing.tools.symmetry">对称</span></div>
          <div class="tool-buttons">
            <button class="symmetry-mode-btn" data-mode="off" onclick="setSymmetry('off')" title="关闭">⬜</button>
            <button class="symmetry-mode-btn" data-mode="horizontal" onclick="setSymmetry('horizontal')" title="左右对称">↔️</button>
            <button class="symmetry-mode-btn" data-mode="vertical" onclick="setSymmetry('vertical')" title="上下对称">↕️</button>
            <button class="symmetry-mode-btn" data-mode="quad" onclick="setSymmetry('quad')" title="四向对称">✚</button>
          </div>
        </div>

        <!-- 颜色选择 -->
        <div class="toolbar-section">
          <div class="toolbar-label" data-i18n="drawing.tools.color">颜色</div>
          <div class="color-buttons">
            <button class="drawing-color-btn" data-color="#FF6B6B" style="background:#FF6B6B" onclick="setDrawingColor('#FF6B6B')"></button>
            <button class="drawing-color-btn" data-color="#FF8E53" style="background:#FF8E53" onclick="setDrawingColor('#FF8E53')"></button>
            <button class="drawing-color-btn" data-color="#FFD93D" style="background:#FFD93D" onclick="setDrawingColor('#FFD93D')"></button>
            <button class="drawing-color-btn" data-color="#6BCB77" style="background:#6BCB77" onclick="setDrawingColor('#6BCB77')"></button>
            <button class="drawing-color-btn" data-color="#4D96FF" style="background:#4D96FF" onclick="setDrawingColor('#4D96FF')"></button>
            <button class="drawing-color-btn" data-color="#9B59B6" style="background:#9B59B6" onclick="setDrawingColor('#9B59B6')"></button>
            <button class="drawing-color-btn active" data-color="#FF69B4" style="background:#FF69B4" onclick="setDrawingColor('#FF69B4')"></button>
            <button class="drawing-color-btn" data-color="#00D2D3" style="background:#00D2D3" onclick="setDrawingColor('#00D2D3')"></button>
            <button class="drawing-color-btn" data-color="#FFFFFF" style="background:#FFFFFF;border:2px solid #ccc" onclick="setDrawingColor('#FFFFFF')"></button>
            <button class="drawing-color-btn" data-color="#2C3E50" style="background:#2C3E50" onclick="setDrawingColor('#2C3E50')"></button>
          </div>
        </div>

        <!-- 大小调节 -->
        <div class="toolbar-section">
          <div class="toolbar-label" data-i18n="drawing.tools.size">大小</div>
          <div class="size-control">
            <input type="range" id="brush-size-slider" min="2" max="50" value="8" onchange="setDrawingSize(this.value)" oninput="setDrawingSize(this.value)">
            <div id="brush-size-preview" class="size-preview"></div>
          </div>
        </div>

        <!-- 操作按钮 -->
        <div class="toolbar-section">
          <div class="toolbar-label" data-i18n="drawing.tools.actions">操作</div>
          <div class="action-buttons">
            <button class="drawing-action-btn" onclick="undoDrawing()" title="撤销">↩️</button>
            <button class="drawing-action-btn" onclick="redoDrawing()" title="重做">↪️</button>
            <button class="drawing-action-btn" onclick="clearDrawing()" title="清空">🗑️</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== 亲子PK模式 ========== -->
  <div id="family-pk-modal" class="family-pk-modal hidden">
    <div class="family-pk-container">
      <!-- 设置界面 -->
      <div id="pk-setup" class="pk-setup">
        <button class="pk-close-btn" onclick="closeFamilyPK()">✕</button>
        <div class="pk-setup-header">
          <span class="pk-header-icon">👨‍👩‍👧</span>
          <h2 data-i18n="familyPK.title">亲子PK</h2>
          <p class="pk-setup-desc" data-i18n="familyPK.desc">家长和孩子面对面PK答题!</p>
        </div>

        <!-- 题型选择 -->
        <div class="pk-setting-section">
          <h3 data-i18n="familyPK.questionType">选择题型</h3>
          <div class="pk-type-buttons">
            <button class="pk-type-btn" data-type="math" onclick="FamilyPK.setQuestionType('math')">
              <span class="type-icon">🔢</span>
              <span class="type-name" data-i18n="menu.math">数学</span>
            </button>
            <button class="pk-type-btn" data-type="english" onclick="FamilyPK.setQuestionType('english')">
              <span class="type-icon">🔤</span>
              <span class="type-name" data-i18n="menu.english">英语</span>
            </button>
            <button class="pk-type-btn" data-type="chinese" onclick="FamilyPK.setQuestionType('chinese')">
              <span class="type-icon">📝</span>
              <span class="type-name" data-i18n="menu.chinese">中文</span>
            </button>
            <button class="pk-type-btn active" data-type="mixed" onclick="FamilyPK.setQuestionType('mixed')">
              <span class="type-icon">🎯</span>
              <span class="type-name" data-i18n="familyPK.mixed">混合</span>
            </button>
          </div>
        </div>

        <!-- 难度选择 -->
        <div class="pk-setting-section">
          <h3 data-i18n="familyPK.difficulty">选择难度</h3>
          <div class="pk-diff-buttons">
            <button class="pk-diff-btn active" data-diff="easy" onclick="FamilyPK.setDifficulty('easy')">
              <span class="diff-icon">😊</span>
              <span class="diff-name" data-i18n="familyPK.easy">简单</span>
            </button>
            <button class="pk-diff-btn" data-diff="medium" onclick="FamilyPK.setDifficulty('medium')">
              <span class="diff-icon">🤔</span>
              <span class="diff-name" data-i18n="familyPK.medium">中等</span>
            </button>
            <button class="pk-diff-btn" data-diff="hard" onclick="FamilyPK.setDifficulty('hard')">
              <span class="diff-icon">😤</span>
              <span class="diff-name" data-i18n="familyPK.hard">困难</span>
            </button>
          </div>
        </div>

        <!-- 回合数选择 -->
        <div class="pk-setting-section">
          <h3 data-i18n="familyPK.rounds">选择回合数</h3>
          <div class="pk-rounds-buttons">
            <button class="pk-rounds-btn" data-rounds="5" onclick="FamilyPK.setRounds(5)">5</button>
            <button class="pk-rounds-btn active" data-rounds="10" onclick="FamilyPK.setRounds(10)">10</button>
            <button class="pk-rounds-btn" data-rounds="15" onclick="FamilyPK.setRounds(15)">15</button>
            <button class="pk-rounds-btn" data-rounds="20" onclick="FamilyPK.setRounds(20)">20</button>
          </div>
        </div>

        <!-- 开始按钮 -->
        <button class="pk-start-btn" onclick="startFamilyPK()">
          <span class="start-icon">🎮</span>
          <span data-i18n="familyPK.start">开始PK!</span>
        </button>
      </div>

      <!-- 游戏界面 -->
      <div id="pk-game" class="pk-game hidden">
        <!-- 回合信息 -->
        <div class="pk-round-info">
          <span class="pk-round-label">🎮 Round</span>
          <span class="pk-round-number"><span id="pk-round-num">1</span>/<span id="pk-total-rounds">10</span></span>
        </div>

        <!-- 家长区域 (旋转180°) -->
        <div class="pk-player-area parent">
          <div class="pk-player-header">
            <span class="pk-player-icon">👨</span>
            <span class="pk-player-name" data-i18n="familyPK.parent">家长</span>
            <span class="pk-player-score"><span id="pk-parent-score">0</span> ⭐</span>
          </div>
          <div id="pk-parent-options" class="pk-options">
            <!-- 选项按钮由JS生成 -->
          </div>
          <div id="pk-parent-feedback" class="pk-feedback hidden"></div>
        </div>

        <!-- 题目区域 (共享) -->
        <div id="pk-question-area" class="pk-question-area">
          <span id="pk-question-type" class="pk-question-type">🔢</span>
          <div id="pk-question-text" class="pk-question-text">3 + 5 = ?</div>
        </div>

        <!-- 倒计时 -->
        <div id="pk-countdown" class="pk-countdown hidden">3</div>

        <!-- 孩子区域 -->
        <div class="pk-player-area child">
          <div class="pk-player-header">
            <span class="pk-player-icon">👧</span>
            <span class="pk-player-name" data-i18n="familyPK.child">宝贝</span>
            <span class="pk-player-score"><span id="pk-child-score">0</span> ⭐</span>
          </div>
          <div id="pk-child-options" class="pk-options">
            <!-- 选项按钮由JS生成 -->
          </div>
          <div id="pk-child-feedback" class="pk-feedback hidden"></div>
        </div>
      </div>

      <!-- 结果界面 -->
      <div id="pk-result" class="pk-result hidden">
        <div class="pk-result-content">
          <div class="pk-result-celebration">🎉</div>
          <div id="pk-result-icon" class="pk-result-icon">🏆</div>
          <h2 id="pk-result-title" class="pk-result-title" data-i18n="familyPK.complete">游戏结束!</h2>

          <div class="pk-result-scores">
            <div class="pk-result-player">
              <span class="result-player-icon">👨</span>
              <span class="result-player-name" data-i18n="familyPK.parent">家长</span>
              <span class="result-player-score" id="pk-result-parent-score">0</span>
            </div>
            <div class="pk-result-vs">VS</div>
            <div class="pk-result-player">
              <span class="result-player-icon">👧</span>
              <span class="result-player-name" data-i18n="familyPK.child">宝贝</span>
              <span class="result-player-score" id="pk-result-child-score">0</span>
            </div>
          </div>

          <div class="pk-result-stats">
            <div class="pk-result-stat">
              <span class="stat-icon">⏱️</span>
              <span class="stat-value" id="pk-result-time">0:00</span>
              <span class="stat-label" data-i18n="familyPK.time">用时</span>
            </div>
          </div>

          <div class="pk-result-buttons">
            <button class="pk-result-btn primary" onclick="playFamilyPKAgain()">
              <span data-i18n="familyPK.playAgain">再玩一次</span>
            </button>
            <button class="pk-result-btn secondary" onclick="closeFamilyPK()">
              <span data-i18n="btn.back">返回</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== 音乐创作 ========== -->
  <div id="music-modal" class="music-modal hidden">
    <div class="music-container">
      <!-- 顶部标题 -->
      <div class="music-header">
        <button class="btn-back" onclick="closeMusic()" data-i18n="btn.back">← 返回</button>
        <h2>🎵 <span data-i18n="music.title">音乐创作</span></h2>
        <button class="btn-save" onclick="saveMusicComposition()">💾</button>
      </div>

      <!-- 模式切换标签 -->
      <div class="music-tabs">
        <button class="music-tab active" data-mode="piano" onclick="switchMusicMode('piano')">
          <span class="tab-icon">🎹</span>
          <span class="tab-name" data-i18n="music.piano">魔法钢琴</span>
        </button>
        <button class="music-tab" data-mode="drums" onclick="switchMusicMode('drums')">
          <span class="tab-icon">🥁</span>
          <span class="tab-name" data-i18n="music.drums">节奏鼓点</span>
        </button>
        <button class="music-tab" data-mode="sequencer" onclick="switchMusicMode('sequencer')">
          <span class="tab-icon">🎨</span>
          <span class="tab-name" data-i18n="music.sequencer">音乐画板</span>
        </button>
      </div>

      <!-- 钢琴面板 -->
      <div id="music-piano" class="music-panel active">
        <!-- 跳舞动物 -->
        <div class="dancing-animals">
          <span class="dancing-animal" data-index="0">🐱</span>
          <span class="dancing-animal" data-index="1">🐶</span>
          <span class="dancing-animal" data-index="2">🐰</span>
          <span class="dancing-animal" data-index="3">🐻</span>
          <span class="dancing-animal" data-index="4">🦊</span>
          <span class="dancing-animal" data-index="5">🐼</span>
          <span class="dancing-animal" data-index="6">🐸</span>
          <span class="dancing-animal" data-index="7">🐵</span>
        </div>

        <!-- 钢琴键盘 -->
        <div class="piano-keyboard">
          <button class="piano-key" data-index="0" style="--key-color: #FF6B6B" onclick="playPianoKey(0)">
            <span class="key-label">1</span>
          </button>
          <button class="piano-key" data-index="1" style="--key-color: #FF8E53" onclick="playPianoKey(1)">
            <span class="key-label">2</span>
          </button>
          <button class="piano-key" data-index="2" style="--key-color: #FFD93D" onclick="playPianoKey(2)">
            <span class="key-label">3</span>
          </button>
          <button class="piano-key" data-index="3" style="--key-color: #6BCB77" onclick="playPianoKey(3)">
            <span class="key-label">4</span>
          </button>
          <button class="piano-key" data-index="4" style="--key-color: #4D96FF" onclick="playPianoKey(4)">
            <span class="key-label">5</span>
          </button>
          <button class="piano-key" data-index="5" style="--key-color: #9B59B6" onclick="playPianoKey(5)">
            <span class="key-label">6</span>
          </button>
          <button class="piano-key" data-index="6" style="--key-color: #FF69B4" onclick="playPianoKey(6)">
            <span class="key-label">7</span>
          </button>
          <button class="piano-key" data-index="7" style="--key-color: #00D2D3" onclick="playPianoKey(7)">
            <span class="key-label">8</span>
          </button>
        </div>

        <!-- 音色选择 -->
        <div class="sound-selector">
          <span class="selector-label">音色:</span>
          <button class="sound-btn active" data-sound="piano" onclick="setPianoSound('piano')">🎹 钢琴</button>
          <button class="sound-btn" data-sound="xylophone" onclick="setPianoSound('xylophone')">🎵 木琴</button>
          <button class="sound-btn" data-sound="bell" onclick="setPianoSound('bell')">🔔 铃铛</button>
        </div>
      </div>

      <!-- 打击乐面板 -->
      <div id="music-drums" class="music-panel">
        <!-- 打击乐器 -->
        <div class="drum-pads">
          <button class="drum-pad" data-drum="kick" style="--drum-color: #FF6B6B" onclick="playDrumPad('kick')">
            <span class="drum-emoji">🥁</span>
            <span class="drum-name">大鼓</span>
          </button>
          <button class="drum-pad" data-drum="snare" style="--drum-color: #FF8E53" onclick="playDrumPad('snare')">
            <span class="drum-emoji">🪘</span>
            <span class="drum-name">小鼓</span>
          </button>
          <button class="drum-pad" data-drum="hihat" style="--drum-color: #FFD93D" onclick="playDrumPad('hihat')">
            <span class="drum-emoji">🔔</span>
            <span class="drum-name">铃鼓</span>
          </button>
          <button class="drum-pad" data-drum="shaker" style="--drum-color: #6BCB77" onclick="playDrumPad('shaker')">
            <span class="drum-emoji">🪇</span>
            <span class="drum-name">沙锤</span>
          </button>
          <button class="drum-pad" data-drum="clap" style="--drum-color: #4D96FF" onclick="playDrumPad('clap')">
            <span class="drum-emoji">👏</span>
            <span class="drum-name">拍手</span>
          </button>
          <button class="drum-pad" data-drum="triangle" style="--drum-color: #9B59B6" onclick="playDrumPad('triangle')">
            <span class="drum-emoji">🎵</span>
            <span class="drum-name">三角铁</span>
          </button>
        </div>

        <!-- 节奏伴奏 -->
        <div class="rhythm-section">
          <span class="selector-label">节奏伴奏:</span>
          <div class="rhythm-buttons">
            <button class="rhythm-btn" data-rhythm="happy" onclick="toggleRhythm('happy')">🎉 欢快</button>
            <button class="rhythm-btn" data-rhythm="lullaby" onclick="toggleRhythm('lullaby')">🌙 摇篮</button>
            <button class="rhythm-btn" data-rhythm="march" onclick="toggleRhythm('march')">🎺 进行曲</button>
          </div>
          <button id="rhythm-play-btn" class="rhythm-stop-btn" onclick="stopRhythm()">⏹️ 停止</button>
        </div>
      </div>

      <!-- 音乐画板面板 -->
      <div id="music-sequencer" class="music-panel">
        <!-- 网格 -->
        <div class="sequencer-grid">
          <div class="seq-row" data-row="0">
            <span class="row-label">🎵</span>
            <button class="seq-cell" data-row="0" data-col="0" onclick="toggleSeqCell(0,0)"></button>
            <button class="seq-cell" data-row="0" data-col="1" onclick="toggleSeqCell(0,1)"></button>
            <button class="seq-cell" data-row="0" data-col="2" onclick="toggleSeqCell(0,2)"></button>
            <button class="seq-cell" data-row="0" data-col="3" onclick="toggleSeqCell(0,3)"></button>
            <button class="seq-cell" data-row="0" data-col="4" onclick="toggleSeqCell(0,4)"></button>
            <button class="seq-cell" data-row="0" data-col="5" onclick="toggleSeqCell(0,5)"></button>
            <button class="seq-cell" data-row="0" data-col="6" onclick="toggleSeqCell(0,6)"></button>
            <button class="seq-cell" data-row="0" data-col="7" onclick="toggleSeqCell(0,7)"></button>
          </div>
          <div class="seq-row" data-row="1">
            <span class="row-label">🎵</span>
            <button class="seq-cell" data-row="1" data-col="0" onclick="toggleSeqCell(1,0)"></button>
            <button class="seq-cell" data-row="1" data-col="1" onclick="toggleSeqCell(1,1)"></button>
            <button class="seq-cell" data-row="1" data-col="2" onclick="toggleSeqCell(1,2)"></button>
            <button class="seq-cell" data-row="1" data-col="3" onclick="toggleSeqCell(1,3)"></button>
            <button class="seq-cell" data-row="1" data-col="4" onclick="toggleSeqCell(1,4)"></button>
            <button class="seq-cell" data-row="1" data-col="5" onclick="toggleSeqCell(1,5)"></button>
            <button class="seq-cell" data-row="1" data-col="6" onclick="toggleSeqCell(1,6)"></button>
            <button class="seq-cell" data-row="1" data-col="7" onclick="toggleSeqCell(1,7)"></button>
          </div>
          <div class="seq-row" data-row="2">
            <span class="row-label">🎵</span>
            <button class="seq-cell" data-row="2" data-col="0" onclick="toggleSeqCell(2,0)"></button>
            <button class="seq-cell" data-row="2" data-col="1" onclick="toggleSeqCell(2,1)"></button>
            <button class="seq-cell" data-row="2" data-col="2" onclick="toggleSeqCell(2,2)"></button>
            <button class="seq-cell" data-row="2" data-col="3" onclick="toggleSeqCell(2,3)"></button>
            <button class="seq-cell" data-row="2" data-col="4" onclick="toggleSeqCell(2,4)"></button>
            <button class="seq-cell" data-row="2" data-col="5" onclick="toggleSeqCell(2,5)"></button>
            <button class="seq-cell" data-row="2" data-col="6" onclick="toggleSeqCell(2,6)"></button>
            <button class="seq-cell" data-row="2" data-col="7" onclick="toggleSeqCell(2,7)"></button>
          </div>
          <div class="seq-row" data-row="3">
            <span class="row-label">🎵</span>
            <button class="seq-cell" data-row="3" data-col="0" onclick="toggleSeqCell(3,0)"></button>
            <button class="seq-cell" data-row="3" data-col="1" onclick="toggleSeqCell(3,1)"></button>
            <button class="seq-cell" data-row="3" data-col="2" onclick="toggleSeqCell(3,2)"></button>
            <button class="seq-cell" data-row="3" data-col="3" onclick="toggleSeqCell(3,3)"></button>
            <button class="seq-cell" data-row="3" data-col="4" onclick="toggleSeqCell(3,4)"></button>
            <button class="seq-cell" data-row="3" data-col="5" onclick="toggleSeqCell(3,5)"></button>
            <button class="seq-cell" data-row="3" data-col="6" onclick="toggleSeqCell(3,6)"></button>
            <button class="seq-cell" data-row="3" data-col="7" onclick="toggleSeqCell(3,7)"></button>
          </div>
          <div class="seq-row" data-row="4">
            <span class="row-label">🎵</span>
            <button class="seq-cell" data-row="4" data-col="0" onclick="toggleSeqCell(4,0)"></button>
            <button class="seq-cell" data-row="4" data-col="1" onclick="toggleSeqCell(4,1)"></button>
            <button class="seq-cell" data-row="4" data-col="2" onclick="toggleSeqCell(4,2)"></button>
            <button class="seq-cell" data-row="4" data-col="3" onclick="toggleSeqCell(4,3)"></button>
            <button class="seq-cell" data-row="4" data-col="4" onclick="toggleSeqCell(4,4)"></button>
            <button class="seq-cell" data-row="4" data-col="5" onclick="toggleSeqCell(4,5)"></button>
            <button class="seq-cell" data-row="4" data-col="6" onclick="toggleSeqCell(4,6)"></button>
            <button class="seq-cell" data-row="4" data-col="7" onclick="toggleSeqCell(4,7)"></button>
          </div>
        </div>

        <!-- 控制按钮 -->
        <div class="sequencer-controls">
          <button id="seq-play-btn" class="seq-btn seq-play" onclick="playSequencer()">▶️ 播放</button>
          <button class="seq-btn seq-clear" onclick="clearSequencer()">🗑️ 清空</button>
        </div>

        <!-- 速度控制 -->
        <div class="tempo-section">
          <span class="selector-label">速度:</span>
          <div class="tempo-buttons">
            <button class="tempo-btn" data-tempo="80" onclick="setTempo(80)">🐢 慢</button>
            <button class="tempo-btn active" data-tempo="120" onclick="setTempo(120)">🐰 中</button>
            <button class="tempo-btn" data-tempo="160" onclick="setTempo(160)">🐆 快</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== 书写练习 ========== -->
  <div id="writing-modal" class="writing-modal hidden">
    <div class="writing-container">
      <!-- 顶部标题 -->
      <div class="writing-header">
        <button class="btn-back" onclick="closeWriting()" data-i18n="btn.back">← 返回</button>
        <h2>✍️ <span data-i18n="writing.title">书写练习</span></h2>
        <div class="header-spacer"></div>
      </div>

      <!-- 模式切换标签 -->
      <div class="writing-tabs">
        <button class="writing-tab active" data-mode="chinese" onclick="switchWritingMode('chinese')">
          <span class="tab-icon">📝</span>
          <span class="tab-name" data-i18n="writing.strokeOrder">汉字笔顺</span>
        </button>
        <button class="writing-tab" data-mode="free" onclick="switchWritingMode('free')">
          <span class="tab-icon">🎯</span>
          <span class="tab-name" data-i18n="writing.freePractice">自由练习</span>
        </button>
      </div>

      <!-- 汉字练习面板 -->
      <div id="writing-chinese" class="writing-panel active">
        <!-- 汉字信息 -->
        <div class="char-info-card">
          <div class="char-display">
            <span id="current-char" class="current-char">一</span>
          </div>
          <div class="char-details">
            <div class="char-pinyin" id="char-pinyin">yī</div>
            <div class="char-meaning" id="char-meaning">1</div>
          </div>
          <button class="char-speak-btn" onclick="speakCurrentChar()" title="听发音">
            🔊
          </button>
        </div>

        <!-- Hanzi Writer 容器 -->
        <div class="hanzi-writer-wrapper">
          <div id="hanzi-writer-container" class="hanzi-writer-container"></div>
          <div id="stroke-info" class="stroke-info">笔画: 0/0  错误: 0次</div>
        </div>

        <!-- 控制按钮 -->
        <div class="char-controls">
          <button id="animate-btn" class="char-btn animate-btn" onclick="animateCharacter()">
            ▶️ <span data-i18n="writing.playStroke">播放笔顺</span>
          </button>
          <button id="start-quiz-btn" class="char-btn quiz-btn" onclick="startCharacterQuiz()">
            ✏️ <span data-i18n="writing.startPractice">开始练习</span>
          </button>
          <button class="char-btn reset-btn" onclick="resetCharacter()">
            🔄 <span data-i18n="writing.reset">重置</span>
          </button>
        </div>

        <!-- 导航按钮 -->
        <div class="char-navigation">
          <button id="prev-char-btn" class="nav-btn" onclick="prevCharacter()">◀️ <span data-i18n="writing.prev">上一个</span></button>
          <button id="next-char-btn" class="nav-btn" onclick="nextCharacter()"><span data-i18n="writing.next">下一个</span> ▶️</button>
        </div>

        <!-- 汉字列表 -->
        <div class="char-list-section">
          <h3 data-i18n="writing.selectChar">选择汉字</h3>
          <div id="character-list" class="character-list"></div>
        </div>
      </div>

      <!-- 自由练习面板 -->
      <div id="writing-free" class="writing-panel">
        <!-- 画布 -->
        <div class="free-canvas-wrapper">
          <canvas id="free-writing-canvas"></canvas>
        </div>

        <!-- 背景选择 -->
        <div class="free-toolbar">
          <div class="toolbar-row">
            <span class="toolbar-label">背景:</span>
            <div class="bg-buttons">
              <button class="bg-btn active" data-bg="blank" onclick="setFreeBackground('blank')">空白</button>
              <button class="bg-btn" data-bg="grid" onclick="setFreeBackground('grid')">田字格</button>
              <button class="bg-btn" data-bg="lines" onclick="setFreeBackground('lines')">四线格</button>
            </div>
          </div>

          <!-- 颜色选择 -->
          <div class="toolbar-row">
            <span class="toolbar-label">笔色:</span>
            <div class="free-color-buttons">
              <button class="free-color-btn active" data-color="#333333" style="background:#333333" onclick="setFreeColor('#333333')"></button>
              <button class="free-color-btn" data-color="#FF6B6B" style="background:#FF6B6B" onclick="setFreeColor('#FF6B6B')"></button>
              <button class="free-color-btn" data-color="#FF8E53" style="background:#FF8E53" onclick="setFreeColor('#FF8E53')"></button>
              <button class="free-color-btn" data-color="#4D96FF" style="background:#4D96FF" onclick="setFreeColor('#4D96FF')"></button>
              <button class="free-color-btn" data-color="#6BCB77" style="background:#6BCB77" onclick="setFreeColor('#6BCB77')"></button>
              <button class="free-color-btn" data-color="#9B59B6" style="background:#9B59B6" onclick="setFreeColor('#9B59B6')"></button>
            </div>
          </div>

          <!-- 笔宽 -->
          <div class="toolbar-row">
            <span class="toolbar-label">笔宽:</span>
            <input type="range" id="free-line-width" min="1" max="20" value="4"
                   onchange="setFreeLineWidth(this.value)" oninput="setFreeLineWidth(this.value)">
          </div>

          <!-- 操作按钮 -->
          <div class="toolbar-row">
            <div class="action-buttons">
              <button class="action-btn" onclick="undoFreeWriting()">↩️ 撤销</button>
              <button class="action-btn" onclick="redoFreeWriting()">↪️ 重做</button>
              <button class="action-btn" onclick="clearFreeWriting()">🗑️ 清空</button>
              <button class="action-btn save-btn" onclick="saveFreeWriting()">💾 保存</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 生活技能弹窗 -->
  <div id="life-skills-modal" class="life-skills-modal hidden">
    <div class="life-skills-modal-content">
      <button class="modal-close-btn" onclick="closeLifeSkills()">✕</button>
      <h2 class="life-skills-title">🏠 <span data-i18n="lifeSkills.title">生活技能</span></h2>
      <div id="life-skills-select" class="life-skills-select">
        <!-- 模块选择 -->
      </div>
      <div id="life-skills-game" class="life-skills-game hidden">
        <!-- 游戏区域 -->
      </div>
      <button class="btn-back-select" id="btn-back-life-select" onclick="backToLifeSkillsSelect()" data-i18n="lifeSkills.backToSelect">← 返回选择</button>
    </div>
  </div>

  <!-- 生活技能完成弹窗 -->
  <div id="life-skills-complete-modal" class="life-skills-complete-modal hidden">
    <div class="life-skills-complete-content">
      <div class="complete-celebration">🎉</div>
      <h3 class="complete-title" id="life-skills-complete-title" data-i18n="lifeSkills.complete">练习完成!</h3>
      <div class="complete-stats" id="life-skills-complete-stats">
        <!-- 统计信息 -->
      </div>
      <div class="complete-actions">
        <button class="btn-play-again" onclick="playLifeSkillsAgain()" data-i18n="lifeSkills.playAgain">再玩一次</button>
        <button class="btn-back-menu" onclick="closeLifeSkillsComplete()" data-i18n="btn.back">返回</button>
      </div>
    </div>
  </div>

  <!-- 歌曲练习弹窗 -->
  <div id="song-practice-modal" class="song-practice-modal hidden">
    <div class="song-practice-content">
      <button class="modal-close-btn" onclick="closeSongPractice()">✕</button>

      <!-- 歌曲标题 -->
      <div class="song-header">
        <span class="song-header-emoji">🎤</span>
        <h2 class="song-header-title">新年歌 RAP</h2>
      </div>

      <!-- 分组筛选 -->
      <div class="song-filter-bar">
        <button class="song-filter-btn active" data-group="all" onclick="setSongFilter('all')">
          <span>🌟</span> 全部
        </button>
        <button class="song-filter-btn" data-group="black" onclick="setSongFilter('black')">
          <span>⬛</span> 黑组
        </button>
        <button class="song-filter-btn" data-group="blue" onclick="setSongFilter('blue')">
          <span>🔵</span> 蓝组
        </button>
        <button class="song-filter-btn" data-group="red" onclick="setSongFilter('red')">
          <span>🔴</span> 红组
        </button>
      </div>

      <!-- 歌词区域 -->
      <div class="song-lyrics-container">
        <div id="song-lyrics" class="song-lyrics">
          <!-- 歌词动态生成 -->
        </div>
      </div>

      <!-- 控制区域 -->
      <div class="song-controls">
        <!-- 速度控制 -->
        <div class="speed-control">
          <button class="speed-btn" data-speed="0.7" onclick="setSongSpeed(0.7)">🐢 <span data-i18n="song.speed.slow">慢</span></button>
          <button class="speed-btn active" data-speed="1" onclick="setSongSpeed(1)" data-i18n="song.speed.normal">正常</button>
          <button class="speed-btn" data-speed="1.3" onclick="setSongSpeed(1.3)">🐇 <span data-i18n="song.speed.fast">快</span></button>
        </div>

        <!-- 播放控制 -->
        <div class="play-control">
          <button class="btn-song-control" id="btn-song-play" onclick="playSong()">
            <span class="control-icon">▶️</span>
            <span>播放</span>
          </button>
          <button class="btn-song-control hidden" id="btn-song-pause" onclick="pauseSong()">
            <span class="control-icon">⏸️</span>
            <span>暂停</span>
          </button>
          <button class="btn-song-control stop" onclick="stopSong()">
            <span class="control-icon">⏹️</span>
            <span>停止</span>
          </button>
        </div>

        <!-- 拼音切换 -->
        <button class="btn-toggle-pinyin" id="btn-toggle-pinyin" onclick="toggleSongPinyin()">
          隐藏拼音
        </button>
      </div>

      <!-- 提示 -->
      <div class="song-tip">
        💡 点击任意一行歌词，从该行开始朗读
      </div>
    </div>
  </div>

  <!-- PWA 更新提示 -->
  <div id="update-notification" class="update-notification hidden">
    <div class="update-content">
      <span class="update-icon">🎉</span>
      <span class="update-text" data-i18n="update.title">发现新版本！</span>
      <button class="update-btn" onclick="applyUpdate()" data-i18n="update.button">立即更新</button>
      <button class="update-close" onclick="hideUpdateNotification()">✕</button>
    </div>
  </div>

  <!-- Puter.js for AI TTS -->
  <script src="https://js.puter.com/v2/"></script>

  <!-- Hanzi Writer for Chinese character stroke order -->
  <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>

  <!-- i18n System -->
  <script src="js/i18n.js"></script>
  <script src="js/locales/en.js"></script>
  <script src="js/locales/zh.js"></script>
  <script src="js/locales/ja.js"></script>
  <script src="js/locales/ko.js"></script>
  <script src="js/locales/es.js"></script>
  <script src="js/locales/de.js"></script>
  <script src="js/locales/fr.js"></script>

  <script src="js/analytics.js"></script>
  <script src="js/scienceData.js"></script>
  <script src="js/puzzleData.js"></script>
  <script src="js/rewards.js"></script>
  <script src="js/achievements.js"></script>
  <script src="js/wrongQuestions.js"></script>
  <script src="js/dailyCheckin.js"></script>
  <script src="js/memoryGame.js"></script>
  <script src="js/learningPet.js"></script>
  <script src="js/petGames.js"></script>
  <script src="js/learningReport.js"></script>
  <script src="js/pictureBook.js"></script>
  <script src="js/pronunciation.js"></script>
  <script src="js/videos.js"></script>
  <script src="js/puzzle.js"></script>
  <script src="js/aiChat.js"></script>
  <script src="js/parentNotify.js"></script>
  <script src="js/drawing.js"></script>
  <script src="js/music.js"></script>
  <script src="js/writing.js"></script>
  <script src="js/lifeSkillsData.js"></script>
  <script src="js/lifeSkills.js"></script>
  <script src="js/songData.js"></script>
  <script src="js/songPractice.js"></script>
  <script src="js/familyPK.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
