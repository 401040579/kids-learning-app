# 更新日志

## 2025-01-23 功能更新

### 0. 画画创作功能

#### 功能概述
支持 Apple Pencil 压感的儿童绘画工具，让孩子自由创作。

#### 核心功能
- **Apple Pencil 压感支持**: 根据压力自动调整笔触粗细
- **多种画笔**: 铅笔、马克笔、蜡笔、橡皮擦、填充
- **丰富调色板**: 10种预设颜色（彩虹色系）
- **画笔大小调节**: 滑块控制 2-50px
- **撤销/重做**: 最多20步历史记录
- **保存作品**: 下载PNG + 保存到作品集

#### ✨ P0 扩展：魔法画笔
| 画笔 | 效果 | 特点 |
|------|------|------|
| 💡 霓虹发光 | 发光描边 + 白色内核 | 在黑底更炫酷 |
| 🌈 彩虹渐变 | 自动循环彩虹色 | 画出彩虹线条 |
| ✨ 闪光星星 | 随机彩色星星粒子 | 梦幻闪烁效果 |

#### 🎨 P0 扩展：涂色模板
预设8种可爱图案供孩子涂色：
- ⭐ 星星、❤️ 爱心、🐟 小鱼、🌸 花朵
- 🏠 房子、🐱 小猫、🦋 蝴蝶、🌈 彩虹

#### 🪣 油漆桶填充
- 点击封闭区域一键填色
- BFS 洪水填充算法
- 支持颜色容差

#### 🌙 黑底模式
- 切换画布背景为深色
- 霓虹画笔效果更炫酷
- 适合夜间使用

#### 画笔特性
| 画笔 | 压感 | 透明度 | 特点 |
|------|------|--------|------|
| 铅笔 | ✅ | 90% | 细腻自然 |
| 马克笔 | ✅ | 70% | 粗犷饱满 |
| 蜡笔 | ❌ | 60% | 质感均匀 |
| 橡皮擦 | ✅ | 100% | 擦除内容 |

#### 技术实现
- Canvas API + Pointer Events
- 高清屏支持（devicePixelRatio 缩放）
- 魔法效果使用 shadowBlur 和 HSL 颜色
- 作品集保存到 localStorage（最多20幅）

---

### 0.1 P1 扩展：贴纸印章 + 对称绘画

#### 🏷️ 贴纸印章
64种可爱贴纸，分4类：
| 分类 | 贴纸数量 | 示例 |
|------|----------|------|
| 🐾 动物 | 16个 | 🐱🐶🐰🐻🦊🐼🦁🐯🦋🐝 |
| 🌸 自然 | 16个 | 🌸🌻🌹🌈⭐🌙☀️🍎❄️🔥 |
| 😊 表情 | 16个 | 😊😍🥰😎🤩💖💕✨💫🎀 |
| 🎁 物品 | 16个 | 🎈🎁🎂🍭🍦🚀👑🎵🎨📚 |

功能：
- 点击画布放置贴纸
- 支持对称模式（放置时自动镜像）
- 可调节贴纸大小（30-100px）

#### 🪞 对称绘画
| 模式 | 图标 | 效果 |
|------|------|------|
| 关闭 | ⬜ | 普通绘画 |
| 左右对称 | ↔️ | 以画布中心为轴左右镜像 |
| 上下对称 | ↕️ | 以画布中心为轴上下镜像 |
| 四向对称 | ✚ | 同时左右+上下镜像，画蝴蝶/花朵效果好 |

特点：
- 适合画对称图案（蝴蝶、花朵、雪花）
- 切换模式时显示参考线（1秒后消失）
- 所有画笔（包括魔法画笔）都支持对称

---

### 1. AI 语音升级

#### 绘本朗读 - AI 神经网络语音
- **技术方案**: 使用 Puter.js AI TTS（基于 AWS Polly Neural）
- **语音特点**: Zhiyu 中文女声，神经网络引擎，声音自然生动
- **用户体验**:
  - 点击"朗读"按钮播放
  - 支持点击"停止"中断
  - 显示加载状态
- **备选方案**: 如果 AI 语音不可用，自动降级到 Web Speech API

#### AI 小助手 - 语音对话功能
- **语音输入**: 点击麦克风按钮，语音提问
- **语音输出**: AI 回复自动朗读
- **自动朗读开关**: 可关闭自动朗读
- **技术实现**:
  - 语音识别: Web Speech API
  - 语音合成: Puter.js AI TTS

---

### 2. 家长通知系统（Bark 推送）

#### 功能概述
通过 Bark App 将孩子的学习动态实时推送到家长的 iPhone。

#### 推送端配置
- 支持**爸爸**和**妈妈**两个独立推送端
- 可分别配置 Bark URL
- 消息同时推送给两位家长

#### 通知类型
| 类型 | 触发条件 | 示例 |
|------|----------|------|
| 成就通知 | 解锁新成就 | "宝贝获得了「数学小达人」成就！" |
| 进度通知 | 每答N题 | "宝贝在数学已完成10道题！" |
| 消息通知 | 孩子主动发送 | "我想你们了~" |
| SOS通知 | 紧急求助 | "宝贝按下了紧急求助按钮！" |

#### 孩子端功能
- **给爸妈留言**: 语音/文字发送消息
- **预设消息**: 一键发送常用消息（想你们了、我饿了等）
- **紧急求助**: SOS 按钮，立即通知家长

#### 设置页面
```
👨 爸爸的 Bark URL: [____________] [测试]
👩 妈妈的 Bark URL: [____________] [测试]

通知选项:
☑️ 成就通知
☑️ 学习进度通知
☑️ 消息通知
每答 [10] 题通知一次
```

---

### 3. 数学游戏扩展

#### 新增设置面板
```
范围: [10以内] [20以内] [30以内]
运算: [➕加] [➖减] [✖️乘] [➗除]
```

#### 运算规则
| 运算 | 规则说明 |
|------|----------|
| 加法 | 两数之和不超过选定范围 |
| 减法 | 结果为正数（大数减小数） |
| 乘法 | 因数根据范围调整（10以内用1-5，20以内用1-9） |
| 除法 | 保证整除，答案为正整数 |

#### 功能特点
- 可自由组合多个运算类型
- 至少保留一个运算
- 设置自动保存到本地存储

---

### 4. 项目配置

#### CLAUDE.md 文件
为 Claude Code 添加项目配置文件，包含：
- 项目简介和技术栈
- 目录结构说明
- 开发规范（CSS/JS 命名约定）
- 核心功能模块对照表
- 常用命令和注意事项

---

## 技术栈

| 技术 | 用途 |
|------|------|
| Puter.js | AI 语音合成（TTS） |
| Web Speech API | 语音识别（STT） |
| Bark API | iOS 推送通知 |
| WebLLM + Qwen2.5 | 本地 AI 聊天 |
| localStorage | 配置持久化 |

---

## 文件变更

```
新增文件:
- js/parentNotify.js    # 家长通知模块
- js/drawing.js         # 画画创作模块
- CLAUDE.md             # 项目配置文件
- CHANGELOG.md          # 更新日志

修改文件:
- index.html            # 新增 UI 组件（画画模态框、菜单入口等）
- css/style.css         # 新增样式（画画工具栏、画布等）
- js/app.js             # 数学游戏扩展
- js/aiChat.js          # 语音对话功能
- js/pictureBook.js     # AI 语音朗读
- js/achievements.js    # 集成家长通知
- sw.js                 # 缓存版本更新 (v20)
```
